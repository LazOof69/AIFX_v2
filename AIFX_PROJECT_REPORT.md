# AIFX v2 - AI 外匯交易顧問系統
## 實務專題書面成果報告

---

# 第一章 系統開發計畫

## 第一節 發展系統的動機

### 1.1.1 背景說明

外匯市場（Foreign Exchange Market）是全球最大的金融市場，每日交易量超過 6 兆美元。對於一般投資者而言，外匯交易面臨以下挑戰：

1. **資訊不對稱**：散戶投資者難以即時獲取並分析大量市場資訊
2. **情緒化決策**：人為交易容易受到貪婪與恐懼影響，導致非理性決策
3. **技術門檻高**：傳統技術分析需要專業知識與長期經驗累積
4. **時間成本高**：外匯市場 24 小時運作，投資者難以持續監控

### 1.1.2 題目選擇動機

近年來，人工智慧與機器學習技術在金融領域的應用日益成熟。深度學習模型（如 LSTM）在時間序列預測上展現出優異的表現，而自然語言處理（NLP）技術則可以有效分析新聞情緒。

本專題旨在結合以下技術，開發一套智能外匯交易顧問系統：

| 技術領域 | 應用方式 |
|----------|----------|
| 深度學習 (LSTM) | 分析歷史價格數據，預測未來走勢 |
| 自然語言處理 (FinBERT) | 分析財經新聞與央行政策，量化市場情緒 |
| 即時通訊 Bot | 透過 Discord / LINE 推送交易訊號 |
| 微服務架構 | 確保系統穩定性與可擴展性 |

---

## 第二節 系統目的

### 1.2.1 主要目標

AIFX v2 系統的主要目標是：

> **開發一套基於人工智慧的外匯交易顧問系統，整合技術分析與情緒分析，透過即時通訊平台向用戶推送交易訊號，協助投資者做出更明智的交易決策。**

### 1.2.2 具體目標

1. **價格預測**：使用 LSTM 深度學習模型分析歷史 OHLCV 數據，預測未來價格走勢方向
2. **情緒分析**：整合 FinBERT 與 VADER 分析財經新聞與央行政策立場
3. **訊號生成**：融合技術分析與情緒分析結果，生成 BUY/SELL/HOLD 交易訊號
4. **即時通知**：透過 Discord Bot 與 LINE Bot 即時推送訊號變化通知
5. **訂閱管理**：讓用戶自由訂閱感興趣的貨幣對，實現個人化服務

### 1.2.3 預定提供之作用

| 功能 | 說明 | 效益 |
|------|------|------|
| AI 訊號生成 | 自動化產生交易建議 | 減少人為情緒干擾 |
| 多週期分析 | 支援日內/周內/月內/季內 | 適應不同交易風格 |
| 即時推播 | 訊號變化即時通知 | 把握交易時機 |
| 情緒量化 | 新聞與政策情緒分數 | 輔助決策判斷 |

---

## 第三節 系統需求

### 1.3.1 系統簡介

#### 服務範圍

AIFX v2 系統服務範圍涵蓋：

- **貨幣對**：EUR/USD（歐元/美元）、USD/JPY（美元/日圓）、GBP/USD（英鎊/美元）
- **交易週期**：日內（15min）、周內（1h）、月內（1d）、季內（1w）
- **通知平台**：Discord、LINE

#### 使用者需求

經需求分析，系統使用者主要需求如下：

| 需求類別 | 具體需求 | 優先級 |
|----------|----------|--------|
| 訊號查詢 | 查詢特定貨幣對的即時交易訊號 | 高 |
| 訂閱通知 | 訂閱貨幣對，訊號變化時自動通知 | 高 |
| 多週期支援 | 根據交易風格選擇不同時間週期 | 中 |
| 技術指標 | 查看 SMA、RSI、MACD 等指標數值 | 中 |
| 情緒分析 | 了解當前市場情緒傾向 | 中 |

#### 系統功能圖

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         AIFX v2 系統功能架構                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        用戶功能模組                              │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │                                                                  │   │
│   │   ┌───────────────┐   ┌───────────────┐   ┌───────────────┐     │   │
│   │   │   訊號查詢    │   │   訂閱管理    │   │   偏好設定    │     │   │
│   │   │               │   │               │   │               │     │   │
│   │   │ • 即時訊號    │   │ • 訂閱貨幣對  │   │ • 風險等級    │     │   │
│   │   │ • 歷史訊號    │   │ • 取消訂閱    │   │ • 通知偏好    │     │   │
│   │   │ • 技術指標    │   │ • 訂閱列表    │   │ • 交易週期    │     │   │
│   │   └───────────────┘   └───────────────┘   └───────────────┘     │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        核心分析模組                              │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │                                                                  │   │
│   │   ┌───────────────┐   ┌───────────────┐   ┌───────────────┐     │   │
│   │   │   價格預測    │   │   情緒分析    │   │   訊號融合    │     │   │
│   │   │   (LSTM)      │   │  (FinBERT)    │   │               │     │   │
│   │   │               │   │               │   │ • 權重計算    │     │   │
│   │   │ • 12 維特徵   │   │ • 新聞情緒    │   │ • 強度判定    │     │   │
│   │   │ • 60 時間步   │   │ • 央行政策    │   │ • 訊號輸出    │     │   │
│   │   └───────────────┘   └───────────────┘   └───────────────┘     │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        系統管理模組                              │   │
│   ├─────────────────────────────────────────────────────────────────┤   │
│   │                                                                  │   │
│   │   ┌───────────────┐   ┌───────────────┐   ┌───────────────┐     │   │
│   │   │   用戶管理    │   │   數據收集    │   │   系統監控    │     │   │
│   │   │               │   │               │   │               │     │   │
│   │   │ • 用戶註冊    │   │ • 市場數據    │   │ • 服務狀態    │     │   │
│   │   │ • 認證授權    │   │ • 混合模式    │   │ • 健康檢查    │     │   │
│   │   │ • 權限控制    │   │ • API 配額    │   │ • 日誌記錄    │     │   │
│   │   └───────────────┘   └───────────────┘   └───────────────┘     │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3.2 系統架構

#### 整體架構圖

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              用戶層 (Client Layer)                           │
├───────────────────────────────┬─────────────────────────────────────────────┤
│        Discord App            │              LINE App                        │
│    (iOS/Android/Desktop)      │         (iOS/Android)                       │
└───────────────┬───────────────┴──────────────────┬──────────────────────────┘
                │ Discord Gateway                   │ HTTPS Webhook
                │ (WebSocket)                       │
                ▼                                   ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Bot 服務層 (Bot Service Layer)                     │
├───────────────────────────────┬─────────────────────────────────────────────┤
│       Discord Bot             │           LINE Bot                           │
│       (Node.js)               │     (Node.js + Express)                     │
│                               │         Port: 3001                           │
│  • 斜線命令 (Slash Commands)  │  • 文字訊息處理                              │
│  • Embed 訊息格式             │  • Flex Message 格式                         │
│  • Redis Pub/Sub 監聽         │  • Redis Pub/Sub 監聽                        │
└───────────────┬───────────────┴──────────────────┬──────────────────────────┘
                │ REST API                          │ REST API
                │ (X-API-Key)                       │ (Bearer Token)
                └────────────────────┬──────────────┘
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       應用服務層 (Application Service Layer)                 │
│                          Backend API (Port 3000)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐     │
│   │   Routes   │───▶│Controllers │───▶│  Services  │───▶│   Models   │     │
│   │   路由層   │    │  控制器層  │    │   服務層   │    │   模型層   │     │
│   └────────────┘    └────────────┘    └─────┬──────┘    └──────┬─────┘     │
│                                              │                  │           │
│   核心服務:                                  │                  │           │
│   • forexService (市場數據)                  │                  │           │
│   • tradingSignalService (訊號生成)          │                  │           │
│   • signalMonitoringService (訊號監控)       │                  │           │
│   • mlEngineService (ML 整合)                │                  │           │
│                                              │                  │           │
└──────────────────────────────────────────────┼──────────────────┼───────────┘
                                               │                  │
              ┌────────────────────────────────┼──────────────────┼─────────┐
              │                                │                  │         │
              ▼                                ▼                  ▼         │
┌───────────────────────┐           ┌─────────────────┐   ┌──────────────┐ │
│      ML Engine        │           │   PostgreSQL    │   │    Redis     │ │
│      (FastAPI)        │           │    Database     │   │    Cache     │ │
│      Port: 8000       │           │   Port: 5432    │   │  Port: 6379  │ │
├───────────────────────┤           ├─────────────────┤   ├──────────────┤ │
│ • LSTM 價格預測       │           │ • users         │   │ • 數據快取   │ │
│ • FinBERT 情緒分析    │           │ • market_data   │   │ • 訊號快取   │ │
│ • VADER 政策分析      │           │ • signals       │   │ • Session    │ │
│ • 訊號融合            │           │ • subscriptions │   │ • Pub/Sub    │ │
│ • A/B Testing         │           │ • ...           │   │              │ │
└───────────────────────┘           └─────────────────┘   └──────────────┘ │
                                                                            │
┌───────────────────────────────────────────────────────────────────────────┘
│
│   外部數據源層 (External Data Layer) - 混合模式:
│   ┌─────────────────────────────────┐    ┌─────────────────────────────────┐
│   │         市場數據 (混合)          │    │         新聞情緒 (混合)          │
│   │  ┌─────────┐    ┌─────────┐    │    │  ┌─────────┐    ┌─────────┐    │
│   │  │ Twelve  │    │ yfinance│    │    │  │ NewsAPI │    │ Google  │    │
│   │  │  Data   │ +  │         │    │    │  │         │ +  │  News   │    │
│   │  │  API    │    │ (備用)  │    │    │  │ (付費)  │    │  RSS    │    │
│   │  └─────────┘    └─────────┘    │    │  └─────────┘    └─────────┘    │
│   └─────────────────────────────────┘    └─────────────────────────────────┘
│
└───────────────────────────────────────────────────────────────────────────
```

#### 架構說明

本系統採用**微服務架構**，各服務職責分明：

| 服務 | 技術 | 端口 | 職責 |
|------|------|------|------|
| Backend API | Node.js + Express | 3000 | 核心業務邏輯、資料庫存取、API 路由 |
| ML Engine | Python + FastAPI | 8000 | 機器學習預測、情緒分析 |
| Discord Bot | Node.js + Discord.js | - | Discord 用戶互動、訊息推播 |
| LINE Bot | Node.js + Express | 3001 | LINE 用戶互動、Webhook 處理 |
| PostgreSQL | PostgreSQL 14 | 5432 | 持久化資料儲存 |
| Redis | Redis 6 | 6379 | 快取、Pub/Sub 訊息佇列 |

#### 微服務通訊規則

```
┌─────────────────────────────────────────────────────────────────┐
│                     微服務通訊架構規則                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ✅ 允許的通訊路徑:                                             │
│                                                                  │
│   Frontend ────REST/JWT────► Backend                            │
│   Discord Bot ──REST/API Key──► Backend                         │
│   LINE Bot ────REST/API Key──► Backend                          │
│   Admin App ───REST/Admin JWT─► Backend                         │
│   Backend ─────REST──────────► ML Engine                        │
│                                                                  │
│   ❌ 禁止的通訊路徑:                                             │
│                                                                  │
│   Discord Bot ──✗──► PostgreSQL (不可直接存取資料庫)            │
│   LINE Bot ─────✗──► PostgreSQL (不可直接存取資料庫)            │
│   ML Engine ────✗──► PostgreSQL (不可直接存取資料庫)            │
│                                                                  │
│   🔑 關鍵原則: 只有 Backend 可直接存取 PostgreSQL               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 第四節 系統預期效益

### 1.4.1 量化效益

| 指標 | 預期效益 | 說明 |
|------|----------|------|
| 訊號準確率 | > 55% | 優於隨機猜測 (50%) |
| API 回應時間 | < 200ms (p95) | 確保用戶體驗 |
| 系統可用性 | > 99% | 高可用性服務 |
| 通知延遲 | < 5 秒 | 訊號變化即時推播 |

### 1.4.2 質化效益

1. **降低決策門檻**：透過 AI 分析，讓一般投資者也能獲得專業級的市場分析
2. **減少情緒干擾**：系統化的訊號生成，避免人為情緒影響決策
3. **節省時間成本**：自動化監控與通知，無需 24 小時盯盤
4. **多元資訊整合**：同時考量技術面與基本面，提供更全面的分析

---

# 第二章 系統分析與設計

## 第一節 系統分析

### 2.1.1 Use Case Diagram (使用案例圖)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           AIFX v2 Use Case Diagram                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                              ┌─────────────────┐                            │
│                              │     系統邊界     │                            │
│   ┌──────────┐               │                 │                            │
│   │          │               │  ┌───────────┐  │                            │
│   │  Discord │───────────────┼─▶│ 查詢訊號  │  │                            │
│   │   用戶   │               │  └───────────┘  │                            │
│   │          │───────────────┼─▶┌───────────┐  │                            │
│   └──────────┘               │  │ 訂閱通知  │  │                            │
│        │                     │  └───────────┘  │                            │
│        │                     │  ┌───────────┐  │                            │
│        └─────────────────────┼─▶│ 取消訂閱  │  │                            │
│                              │  └───────────┘  │                            │
│   ┌──────────┐               │  ┌───────────┐  │                            │
│   │          │───────────────┼─▶│ 查看訂閱  │  │                            │
│   │   LINE   │               │  └───────────┘  │                            │
│   │   用戶   │───────────────┼─▶┌───────────┐  │                            │
│   │          │               │  │ 設定偏好  │  │                            │
│   └──────────┘               │  └───────────┘  │                            │
│                              │                 │                            │
│                              │  ┌───────────┐  │       ┌──────────┐        │
│                              │  │ 訊號生成  │◀─┼───────│ ML Engine│        │
│                              │  └───────────┘  │       └──────────┘        │
│   ┌──────────┐               │  ┌───────────┐  │                            │
│   │          │───────────────┼─▶│ 用戶管理  │  │                            │
│   │  Admin   │               │  └───────────┘  │                            │
│   │  管理員  │───────────────┼─▶┌───────────┐  │                            │
│   │          │               │  │ 系統監控  │  │                            │
│   └──────────┘               │  └───────────┘  │                            │
│                              │  ┌───────────┐  │                            │
│                              │  │ 情緒測試  │  │                            │
│                              │  └───────────┘  │                            │
│                              │                 │                            │
│                              └─────────────────┘                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.1.2 Activity Diagram (活動圖) - 訊號查詢流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        訊號查詢活動圖                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                              ●                                               │
│                              │                                               │
│                              ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │  用戶發送指令   │                                      │
│                    │ /signal EUR/USD │                                      │
│                    └────────┬────────┘                                      │
│                              │                                               │
│                              ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │  Bot 解析指令   │                                      │
│                    └────────┬────────┘                                      │
│                              │                                               │
│                              ▼                                               │
│                    ┌─────────────────┐                                      │
│                    │ 呼叫 Backend API│                                      │
│                    └────────┬────────┘                                      │
│                              │                                               │
│                              ▼                                               │
│                    ◇─────────────────◇                                      │
│                   ╱ 快取是否命中？ ╲                                        │
│                  ╱                   ╲                                       │
│                 ▼ 是                  ▼ 否                                   │
│        ┌───────────────┐     ┌───────────────┐                              │
│        │ 返回快取結果  │     │ 獲取市場數據  │                              │
│        └───────┬───────┘     └───────┬───────┘                              │
│                │                      │                                      │
│                │                      ▼                                      │
│                │             ┌───────────────┐                              │
│                │             │ 呼叫 ML Engine│                              │
│                │             │   進行預測    │                              │
│                │             └───────┬───────┘                              │
│                │                      │                                      │
│                │                      ▼                                      │
│                │             ┌───────────────┐                              │
│                │             │  情緒分析     │                              │
│                │             └───────┬───────┘                              │
│                │                      │                                      │
│                │                      ▼                                      │
│                │             ┌───────────────┐                              │
│                │             │  訊號融合     │                              │
│                │             └───────┬───────┘                              │
│                │                      │                                      │
│                │                      ▼                                      │
│                │             ┌───────────────┐                              │
│                │             │  快取結果     │                              │
│                │             └───────┬───────┘                              │
│                │                      │                                      │
│                └──────────┬───────────┘                                      │
│                           │                                                  │
│                           ▼                                                  │
│                  ┌───────────────┐                                          │
│                  │ 組裝回應訊息  │                                          │
│                  └───────┬───────┘                                          │
│                           │                                                  │
│                           ▼                                                  │
│                  ┌───────────────┐                                          │
│                  │ 發送給用戶    │                                          │
│                  └───────┬───────┘                                          │
│                           │                                                  │
│                           ▼                                                  │
│                           ◉                                                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.1.3 Sequence Diagram (序列圖) - 訂閱通知流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        訂閱通知序列圖                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  User      Bot       Backend     PostgreSQL    Redis     ML Engine          │
│   │         │           │            │           │           │              │
│   │ 訂閱指令│           │            │           │           │              │
│   │────────▶│           │            │           │           │              │
│   │         │ POST /subscribe        │           │           │              │
│   │         │──────────▶│            │           │           │              │
│   │         │           │ 查詢用戶   │           │           │              │
│   │         │           │───────────▶│           │           │              │
│   │         │           │◀───────────│           │           │              │
│   │         │           │ 建立訂閱   │           │           │              │
│   │         │           │───────────▶│           │           │              │
│   │         │           │◀───────────│           │           │              │
│   │         │◀──────────│            │           │           │              │
│   │◀────────│ 訂閱成功  │            │           │           │              │
│   │         │           │            │           │           │              │
│   │         │     ... 時間經過 ...   │           │           │              │
│   │         │           │            │           │           │              │
│   │         │           │ [每15分鐘] │           │           │              │
│   │         │           │ 信號監控   │           │           │              │
│   │         │           │───────────▶│           │           │              │
│   │         │           │◀───────────│           │           │              │
│   │         │           │            │           │           │              │
│   │         │           │────────────────────────────────────▶│              │
│   │         │           │            │           │  獲取預測 │              │
│   │         │           │◀───────────────────────────────────│              │
│   │         │           │            │           │           │              │
│   │         │           │ 比對舊訊號 │           │           │              │
│   │         │           │───────────────────────▶│           │              │
│   │         │           │◀──────────────────────│           │              │
│   │         │           │            │           │           │              │
│   │         │           │ [偵測到變化]           │           │              │
│   │         │           │ 發布 signal-change     │           │              │
│   │         │           │───────────────────────▶│           │              │
│   │         │           │            │           │           │              │
│   │         │◀──────────────────────────────────│           │              │
│   │         │  接收 Pub/Sub 事件     │           │           │              │
│   │         │           │            │           │           │              │
│   │◀────────│           │            │           │           │              │
│   │ 推送通知│           │            │           │           │              │
│   │         │           │            │           │           │              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.1.4 Component Diagram (元件圖)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           元件圖                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        Frontend Layer                                │   │
│   │   ┌─────────────┐    ┌─────────────┐                                │   │
│   │   │ Discord Bot │    │  LINE Bot   │                                │   │
│   │   │  Component  │    │  Component  │                                │   │
│   │   └──────┬──────┘    └──────┬──────┘                                │   │
│   └──────────┼──────────────────┼───────────────────────────────────────┘   │
│              │                  │                                            │
│              │  <<interface>>   │  <<interface>>                            │
│              │  REST API        │  REST API                                 │
│              │                  │                                            │
│   ┌──────────┼──────────────────┼───────────────────────────────────────┐   │
│   │          ▼                  ▼         Backend Layer                  │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │                   Backend API Component                      │   │   │
│   │   │   ┌───────────┐  ┌───────────┐  ┌───────────┐               │   │   │
│   │   │   │  Auth     │  │  Trading  │  │Subscription│               │   │   │
│   │   │   │ Controller│  │ Controller│  │ Controller │               │   │   │
│   │   │   └─────┬─────┘  └─────┬─────┘  └─────┬─────┘               │   │   │
│   │   │         │              │              │                      │   │   │
│   │   │   ┌─────▼──────────────▼──────────────▼─────┐               │   │   │
│   │   │   │              Service Layer               │               │   │   │
│   │   │   │  ┌────────────┐  ┌────────────────────┐ │               │   │   │
│   │   │   │  │ForexService│  │TradingSignalService│ │               │   │   │
│   │   │   │  └────────────┘  └────────────────────┘ │               │   │   │
│   │   │   │  ┌────────────────────┐  ┌────────────┐ │               │   │   │
│   │   │   │  │SignalMonitorService│  │MLEngineServ│ │               │   │   │
│   │   │   │  └────────────────────┘  └────────────┘ │               │   │   │
│   │   │   └─────────────────────────────────────────┘               │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│              ┌─────────────────────┼─────────────────────┐                 │
│              │                     │                     │                  │
│              ▼                     ▼                     ▼                  │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐          │
│   │    ML Engine    │   │   PostgreSQL    │   │     Redis       │          │
│   │    Component    │   │    Component    │   │    Component    │          │
│   │                 │   │                 │   │                 │          │
│   │ ┌─────────────┐ │   │ ┌─────────────┐ │   │ ┌─────────────┐ │          │
│   │ │PricePredictor│ │   │ │   Users     │ │   │ │   Cache     │ │          │
│   │ └─────────────┘ │   │ │  MarketData │ │   │ │   Pub/Sub   │ │          │
│   │ ┌─────────────┐ │   │ │   Signals   │ │   │ └─────────────┘ │          │
│   │ │SentimentAnlz│ │   │ │Subscriptions│ │   │                 │          │
│   │ └─────────────┘ │   │ └─────────────┘ │   │                 │          │
│   └─────────────────┘   └─────────────────┘   └─────────────────┘          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 第二節 資料庫設計

### 2.2.1 Enhanced-ER Model (增強型實體關係模型)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Enhanced ER Diagram                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                              ┌───────────┐                                  │
│                              │   users   │                                  │
│                              │───────────│                                  │
│                              │ PK: id    │                                  │
│                              │ email     │                                  │
│                              │ username  │                                  │
│                              │ password  │                                  │
│                              │ is_active │                                  │
│                              │created_at │                                  │
│                              └─────┬─────┘                                  │
│                                    │                                        │
│                     ┌──────────────┼──────────────┐                        │
│                     │              │              │                         │
│                     │ 1:1          │ 1:1          │ 1:N                     │
│                     ▼              ▼              ▼                         │
│          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐       │
│          │user_discord_    │ │user_line_       │ │user_            │       │
│          │settings         │ │settings         │ │subscriptions    │       │
│          │─────────────────│ │─────────────────│ │─────────────────│       │
│          │ PK: id          │ │ PK: id          │ │ PK: id          │       │
│          │ FK: user_id     │ │ FK: user_id     │ │ FK: user_id     │       │
│          │ discord_id (UQ) │ │ line_user_id(UQ)│ │ pair            │       │
│          │ notification_   │ │ display_name    │ │ timeframe       │       │
│          │ enabled         │ │ notification_   │ │ platform        │       │
│          │ preferred_pairs │ │ enabled         │ │ is_active       │       │
│          │ risk_level      │ │ preferred_pairs │ │ last_notified   │       │
│          └─────────────────┘ └─────────────────┘ └─────────────────┘       │
│                                                                              │
│          ┌─────────────────┐ ┌─────────────────┐                           │
│          │  market_data    │ │ trading_signals │                           │
│          │─────────────────│ │─────────────────│                           │
│          │ PK: id          │ │ PK: id          │                           │
│          │ pair            │ │ FK: user_id     │                           │
│          │ timeframe       │ │ pair            │                           │
│          │ open            │ │ timeframe       │                           │
│          │ high            │ │ signal          │                           │
│          │ low             │ │ confidence      │                           │
│          │ close           │ │ signal_strength │                           │
│          │ volume          │ │ market_condition│                           │
│          │ timestamp (UQ)  │ │ entry_price     │                           │
│          │ created_at      │ │ stop_loss       │                           │
│          └─────────────────┘ │ take_profit     │                           │
│                              │ indicators      │                           │
│                              │ sentiment_data  │                           │
│                              │ created_at      │                           │
│                              └─────────────────┘                           │
│                                                                              │
│  Legend:                                                                    │
│  ─────                                                                      │
│  PK = Primary Key                                                           │
│  FK = Foreign Key                                                           │
│  UQ = Unique Constraint                                                     │
│  1:1 = One-to-One Relationship                                             │
│  1:N = One-to-Many Relationship                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2.2 資料表結構

#### users (用戶表)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| email | VARCHAR(255) | UNIQUE, NOT NULL | 電子郵件 |
| username | VARCHAR(100) | UNIQUE, NOT NULL | 用戶名稱 |
| password_hash | VARCHAR(255) | NOT NULL | 密碼雜湊值 |
| is_active | BOOLEAN | DEFAULT true | 帳號是否啟用 |
| is_verified | BOOLEAN | DEFAULT false | 是否已驗證 |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |
| updated_at | TIMESTAMP | DEFAULT NOW() | 更新時間 |

#### user_discord_settings (Discord 用戶設定)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| user_id | INTEGER | FOREIGN KEY (users.id) | 關聯用戶 |
| discord_id | VARCHAR(50) | UNIQUE, NOT NULL | Discord 用戶 ID |
| discord_username | VARCHAR(100) | | Discord 用戶名 |
| notification_enabled | BOOLEAN | DEFAULT true | 是否啟用通知 |
| preferred_pairs | TEXT[] | | 偏好貨幣對陣列 |
| risk_level | INTEGER | DEFAULT 5 | 風險等級 (1-10) |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |

#### user_line_settings (LINE 用戶設定)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| user_id | INTEGER | FOREIGN KEY (users.id) | 關聯用戶 |
| line_user_id | VARCHAR(50) | UNIQUE, NOT NULL | LINE 用戶 ID |
| display_name | VARCHAR(100) | | 顯示名稱 |
| notification_enabled | BOOLEAN | DEFAULT true | 是否啟用通知 |
| preferred_pairs | TEXT[] | | 偏好貨幣對陣列 |
| risk_level | INTEGER | DEFAULT 5 | 風險等級 (1-10) |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |

#### market_data (市場數據)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| pair | VARCHAR(10) | NOT NULL | 貨幣對 (EUR/USD) |
| timeframe | VARCHAR(10) | NOT NULL | 時間框架 (1h) |
| open | DECIMAL(20,10) | NOT NULL | 開盤價 |
| high | DECIMAL(20,10) | NOT NULL | 最高價 |
| low | DECIMAL(20,10) | NOT NULL | 最低價 |
| close | DECIMAL(20,10) | NOT NULL | 收盤價 |
| volume | DECIMAL(20,4) | | 成交量 |
| timestamp | TIMESTAMP | NOT NULL | K 線時間戳 |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |

**索引**：
- `UNIQUE(pair, timeframe, timestamp)`
- `INDEX idx_market_data_pair_timeframe ON market_data(pair, timeframe)`
- `INDEX idx_market_data_timestamp ON market_data(timestamp DESC)`

#### trading_signals (交易訊號)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| user_id | INTEGER | FOREIGN KEY (users.id) | 關聯用戶 (可為空) |
| pair | VARCHAR(10) | NOT NULL | 貨幣對 |
| timeframe | VARCHAR(10) | NOT NULL | 時間框架 |
| signal | VARCHAR(10) | NOT NULL | 訊號 (buy/sell/hold) |
| confidence | DECIMAL(5,4) | | 信心度 (0.0000-1.0000) |
| signal_strength | VARCHAR(20) | | 訊號強度 |
| market_condition | VARCHAR(20) | | 市場狀況 |
| entry_price | DECIMAL(20,10) | | 入場價格 |
| stop_loss | DECIMAL(20,10) | | 停損價格 |
| take_profit | DECIMAL(20,10) | | 獲利目標價格 |
| indicators | JSONB | | 技術指標 JSON |
| sentiment_data | JSONB | | 情緒數據 JSON |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |

#### user_subscriptions (用戶訂閱)

| 欄位 | 資料型態 | 限制 | 說明 |
|------|----------|------|------|
| id | SERIAL | PRIMARY KEY | 自動遞增主鍵 |
| user_id | INTEGER | FOREIGN KEY (users.id) | 關聯用戶 |
| pair | VARCHAR(10) | NOT NULL | 訂閱貨幣對 |
| timeframe | VARCHAR(10) | NOT NULL | 訂閱時間框架 |
| platform | VARCHAR(20) | NOT NULL | 平台 (discord/line) |
| is_active | BOOLEAN | DEFAULT true | 是否啟用 |
| last_notified_at | TIMESTAMP | | 上次通知時間 |
| created_at | TIMESTAMP | DEFAULT NOW() | 建立時間 |
| updated_at | TIMESTAMP | DEFAULT NOW() | 更新時間 |

**唯一約束**：`UNIQUE(user_id, pair, timeframe, platform)`

---

## 第三節 系統開發時程

### 2.3.1 甘特圖

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           專題開發甘特圖                                     │
│                         (2025年9月 - 2025年12月)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  任務                         │ 9月 │ 10月 │ 11月 │ 12月 │ 負責人          │
│  ─────────────────────────────┼─────┼──────┼──────┼──────┼────────────────  │
│                               │     │      │      │      │                  │
│  █ 需求分析與規劃             │████ │      │      │      │ 全體            │
│    ├ 需求訪談                 │██   │      │      │      │                  │
│    ├ 系統規劃                 │ ██  │      │      │      │                  │
│    └ 技術選型                 │  ██ │      │      │      │                  │
│                               │     │      │      │      │                  │
│  █ 系統設計                   │ ████│██    │      │      │ 全體            │
│    ├ 架構設計                 │  ███│      │      │      │                  │
│    ├ 資料庫設計               │   ██│█     │      │      │                  │
│    └ API 設計                 │    █│██    │      │      │                  │
│                               │     │      │      │      │                  │
│  █ Backend 開發               │     │██████│████  │      │ 成員 A          │
│    ├ 基礎架構                 │     │███   │      │      │                  │
│    ├ API 實作                 │     │  ████│█     │      │                  │
│    └ 認證系統                 │     │      │██    │      │                  │
│                               │     │      │      │      │                  │
│  █ ML Engine 開發             │     │ █████│█████ │      │ 成員 B          │
│    ├ LSTM 模型                │     │ ████ │      │      │                  │
│    ├ 情緒分析                 │     │    ██│███   │      │                  │
│    └ 訊號融合                 │     │      │  ███ │      │                  │
│                               │     │      │      │      │                  │
│  █ Bot 開發                   │     │      │██████│██    │ 成員 C          │
│    ├ Discord Bot              │     │      │████  │      │                  │
│    ├ LINE Bot                 │     │      │  ████│      │                  │
│    └ 訂閱通知                 │     │      │    ██│██    │                  │
│                               │     │      │      │      │                  │
│  █ 整合測試                   │     │      │   ███│████  │ 全體            │
│    ├ 單元測試                 │     │      │   ██ │      │                  │
│    ├ 整合測試                 │     │      │    ██│██    │                  │
│    └ 效能測試                 │     │      │      │██    │                  │
│                               │     │      │      │      │                  │
│  █ 文件撰寫                   │     │      │    ██│████  │ 全體            │
│    ├ 技術文件                 │     │      │    ██│█     │                  │
│    ├ 使用手冊                 │     │      │      │██    │                  │
│    └ 專題報告                 │     │      │      │ ███  │                  │
│                               │     │      │      │      │                  │
│  █ 部署上線                   │     │      │      │████  │ 全體            │
│                               │     │      │      │      │                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3.2 開發進度說明

| 階段 | 時間 | 主要工作 | 實際完成 |
|------|------|----------|----------|
| 需求分析 | 9月 W1-W4 | 需求訪談、系統規劃、技術選型 | ✅ 100% |
| 系統設計 | 9月W3-10月W2 | 架構設計、資料庫設計、API 設計 | ✅ 100% |
| Backend 開發 | 10月W1-11月W2 | 基礎架構、API 實作、認證系統 | ✅ 100% |
| ML Engine | 10月W2-11月W3 | LSTM 模型、情緒分析、訊號融合 | ✅ 100% |
| Bot 開發 | 11月W1-12月W1 | Discord Bot、LINE Bot、訂閱通知 | ✅ 100% |
| 整合測試 | 11月W3-12月W2 | 單元測試、整合測試、效能測試 | ✅ 100% |
| 文件撰寫 | 11月W4-12月W3 | 技術文件、使用手冊、專題報告 | ✅ 100% |
| 部署上線 | 12月W1-W4 | 環境配置、服務部署、監控設置 | ✅ 100% |

---

## 第四節 其他系統相關設計或考量

### 2.4.1 資訊安全機制

#### 身分認證機制

| 認證類型 | 使用對象 | 實作方式 |
|----------|----------|----------|
| JWT Token | 前端用戶 | RS256 簽章，15 分鐘過期 |
| Refresh Token | 前端用戶 | 7 天過期，可換發新 Token |
| API Key | Discord Bot | 64 字元十六進位，永不過期 |
| API Key | LINE Bot | 64 字元十六進位，永不過期 |
| Admin JWT | 管理員 | RS256 簽章，1 小時過期 |

#### 存取控制

```
┌─────────────────────────────────────────────────────────────────┐
│                      存取控制矩陣                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  資源 / 角色        │ 匿名 │ 用戶 │ Bot │ Admin │               │
│  ───────────────────┼──────┼──────┼─────┼───────┼               │
│  /health            │  R   │  R   │  R  │   R   │               │
│  /auth/login        │  W   │  -   │  -  │   -   │               │
│  /trading/signal    │  -   │  R   │  R  │   R   │               │
│  /subscriptions     │  -   │ RW   │ RW  │  RWD  │               │
│  /admin/*           │  -   │  -   │  -  │  RWD  │               │
│  /discord/*         │  -   │  -   │ RW  │  RWD  │               │
│  /line/*            │  -   │  -   │ RW  │  RWD  │               │
│                                                                  │
│  R = Read, W = Write, D = Delete, - = No Access                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 安全措施

| 措施 | 實作方式 | 目的 |
|------|----------|------|
| 密碼雜湊 | bcrypt (10 rounds) | 保護用戶密碼 |
| HTTPS | TLS 1.3 | 傳輸加密 |
| 速率限制 | 100 req/min/IP | 防止暴力攻擊 |
| CORS | 白名單機制 | 防止跨站請求 |
| Helmet | 安全標頭 | 防止常見攻擊 |
| 輸入驗證 | Joi Schema | 防止注入攻擊 |

### 2.4.2 系統可用性設計

#### 快取策略

| 資料類型 | 快取位置 | TTL | 說明 |
|----------|----------|-----|------|
| 市場數據 | Redis | 60 秒 | 即時數據短期快取 |
| 交易訊號 | Redis | 60 秒 | 訊號結果快取 |
| 情緒分析 | ML Engine 內部 | 1 小時 | 新聞情緒快取 |
| 用戶 Session | Redis | 24 小時 | 登入狀態 |

#### 混合模式數據策略

本系統採用**雙重混合模式**，同時在市場數據和新聞情緒上使用多數據源：

##### 市場數據混合模式

主要使用 Twelve Data API，yfinance 作為備用來源，節省 API 配額 (Twelve Data 每日限額 800 次)：

```
市場數據獲取流程:
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│   需要 100 根 K 線數據                                       │
│        │                                                     │
│        ▼                                                     │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  從 PostgreSQL 讀取最近 99 根歷史 K 線               │   │
│   │  (不消耗 API 配額)                                   │   │
│   └───────────────────────────┬─────────────────────────┘   │
│                               │                              │
│                               ▼                              │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  從 Twelve Data API 獲取 1 根最新 K 線              │   │
│   │  (消耗 1 次 API 配額)                               │   │
│   │  ┌─────────────────────────────────────────────┐   │   │
│   │  │  若 Twelve Data 失敗 → 自動切換 yfinance     │   │   │
│   │  └─────────────────────────────────────────────┘   │   │
│   └───────────────────────────┬─────────────────────────┘   │
│                               │                              │
│                               ▼                              │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  合併數據: [最新 1 根] + [歷史 99 根] = 100 根      │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                              │
│   效益: 節省 99% API 配額 + 備用來源保障可用性              │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

##### 新聞情緒混合模式

同時使用 NewsAPI (付費功能較多) 和 Google News RSS (免費無限制)：

```
新聞情緒獲取流程:
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│   新聞情緒分析請求                                           │
│        │                                                     │
│        ▼                                                     │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  嘗試 NewsAPI (功能完整，100 req/day 免費)          │   │
│   │  • 支援多語言                                        │   │
│   │  • 支援時間範圍篩選                                  │   │
│   └───────────────────────────┬─────────────────────────┘   │
│                               │                              │
│                      (若失敗或配額用盡)                      │
│                               │                              │
│                               ▼                              │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  自動切換 Google News RSS (完全免費，無限制)        │   │
│   │  • 即時新聞抓取                                      │   │
│   │  • 無 API 配額限制                                   │   │
│   └───────────────────────────┬─────────────────────────┘   │
│                               │                              │
│                               ▼                              │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  FinBERT 情緒分析 → 產生情緒分數                    │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                              │
│   效益: 雙來源保障 + 成本控制 + 高可用性                    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 2.4.3 錯誤處理機制

#### 統一錯誤回應格式

```javascript
// 成功回應
{
  "success": true,
  "data": { ... },
  "error": null,
  "timestamp": "2025-12-03T10:30:00Z"
}

// 錯誤回應
{
  "success": false,
  "data": null,
  "error": {
    "code": "INVALID_PAIR",
    "message": "無效的貨幣對格式"
  },
  "timestamp": "2025-12-03T10:30:00Z"
}
```

#### 錯誤代碼表

| 錯誤代碼 | HTTP 狀態碼 | 說明 |
|----------|-------------|------|
| INVALID_PAIR | 400 | 無效的貨幣對格式 |
| INVALID_TIMEFRAME | 400 | 無效的時間框架 |
| UNAUTHORIZED | 401 | 未授權存取 |
| FORBIDDEN | 403 | 禁止存取 |
| NOT_FOUND | 404 | 資源不存在 |
| RATE_LIMIT | 429 | 請求頻率超限 |
| ML_ENGINE_ERROR | 503 | ML Engine 服務異常 |

---

# 第三章 系統實作成果

## 第一節 系統作業環境

### 3.1.1 硬體規格

| 項目 | 規格 |
|------|------|
| 伺服器 | Oracle Cloud ARM64 |
| CPU | 4 Core ARM |
| 記憶體 | 24 GB RAM |
| 儲存空間 | 200 GB SSD |
| 網路 | 公網 IP |

### 3.1.2 軟體規格

| 軟體 | 版本 | 用途 |
|------|------|------|
| Ubuntu | 20.04 LTS | 作業系統 |
| Node.js | 18.x LTS | Backend / Bot 執行環境 |
| Python | 3.9 | ML Engine 執行環境 |
| PostgreSQL | 14.x | 關聯式資料庫 |
| Redis | 6.x | 快取與訊息佇列 |
| PM2 | latest | Node.js 程序管理 |
| Nginx | latest | 反向代理 |

### 3.1.3 開發工具

| 工具 | 用途 |
|------|------|
| VS Code | 程式碼編輯器 |
| Git | 版本控制 |
| GitHub | 程式碼託管 |
| Postman | API 測試 |
| pgAdmin | 資料庫管理 |
| Redis CLI | Redis 管理 |

---

## 第二節 系統功能與介面說明

### 3.2.1 系統流程說明

#### 整體系統流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           系統整體流程圖                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   [用戶]                                                                     │
│     │                                                                        │
│     │ 1. 發送指令 (Discord/LINE)                                            │
│     ▼                                                                        │
│   [Bot 服務]                                                                │
│     │                                                                        │
│     │ 2. 解析指令，呼叫 Backend API                                         │
│     ▼                                                                        │
│   [Backend API]                                                             │
│     │                                                                        │
│     ├─── 3a. 查詢 Redis 快取 ───▶ [命中] ─▶ 返回快取結果                    │
│     │                                                                        │
│     │ 3b. [未命中]                                                           │
│     │                                                                        │
│     ├─── 4. 獲取市場數據 (混合模式)                                         │
│     │     ├── PostgreSQL (歷史 99 根)                                       │
│     │     └── Twelve Data API (最新 1 根)                                   │
│     │                                                                        │
│     ├─── 5. 呼叫 ML Engine                                                  │
│     │     ├── LSTM 價格預測                                                 │
│     │     ├── FinBERT 情緒分析                                              │
│     │     └── 訊號融合                                                      │
│     │                                                                        │
│     ├─── 6. 快取結果到 Redis                                                │
│     │                                                                        │
│     └─── 7. 返回結果給 Bot                                                  │
│                                                                              │
│   [Bot 服務]                                                                │
│     │                                                                        │
│     │ 8. 格式化訊息 (Embed/Flex Message)                                    │
│     ▼                                                                        │
│   [用戶]                                                                     │
│     │                                                                        │
│     └── 9. 收到交易訊號回應                                                 │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2.2 系統功能說明

#### Discord Bot 功能

| 指令 | 功能說明 | 參數 |
|------|----------|------|
| `/signal` | 查詢交易訊號 | 貨幣對、週期 |
| `/subscribe` | 訂閱信號通知 | 貨幣對、時間框架 |
| `/unsubscribe` | 取消訂閱 | 貨幣對、時間框架 |
| `/subscriptions` | 查看訂閱列表 | 無 |
| `/position` | 持倉建議 | 貨幣對 |
| `/preferences` | 設定偏好 | 無 |
| `/trading-guide` | 交易指南 | 無 |
| `/ping` | 連線測試 | 無 |

#### LINE Bot 功能

| 指令 | 功能說明 | 範例 |
|------|----------|------|
| 貨幣對 | 查詢訊號 | `EUR/USD` |
| 貨幣對 + 週期 | 指定週期查詢 | `EUR/USD 周內` |
| 訂閱 | 訂閱通知 | `訂閱 EUR/USD` |
| 取消訂閱 | 取消訂閱 | `取消訂閱 EUR/USD` |
| 我的訂閱 | 查看訂閱 | `我的訂閱` |
| 幫助 | 顯示說明 | `幫助` |

### 3.2.3 系統操作與介面說明

#### Discord Bot 介面

**訊號查詢畫面**

```
┌────────────────────────────────────────────────────────────┐
│  📊 AIFX 交易訊號                                          │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  貨幣對: EUR/USD                                            │
│  週期: 周內 (1h)                                            │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  🟢 訊號: 買入 (LONG)                                       │
│                                                             │
│  💪 信心度        75%                                       │
│  📊 強度          STRONG                                    │
│  📈 市場狀況      TRENDING                                  │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  💰 入場價格      1.08500                                   │
│  🛑 停損價格      1.08200                                   │
│  🎯 目標價格      1.09000                                   │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  📉 技術指標                                                │
│  SMA(20): 1.08450  RSI(14): 58.5                           │
│  MACD: 0.00125     BB: 1.0820 - 1.0880                     │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  ⚠️ 僅供參考，請自行評估風險，過去績效不代表未來表現       │
│                                                             │
│  AIFX v2 • 2025-12-03 14:30:00                             │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

**訂閱成功畫面**

```
┌────────────────────────────────────────────────────────────┐
│  ✅ 訂閱成功                                                │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  已成功訂閱 EUR/USD (1h) 的信號變化通知                     │
│                                                             │
│  當訊號從 HOLD 變為 BUY 或 SELL 時，                        │
│  系統將自動推送通知給您。                                   │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  📌 提示:                                                   │
│  • 使用 /subscriptions 查看所有訂閱                        │
│  • 使用 /unsubscribe 取消訂閱                              │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

**信號變化通知**

```
┌────────────────────────────────────────────────────────────┐
│  🔔 信號變化通知                                            │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  🟢 EUR/USD (1h)                                           │
│                                                             │
│  📊 信號變化: HOLD → BUY                                    │
│                                                             │
│  💪 信心度: 75%                                             │
│  📈 強度: STRONG                                            │
│  📉 市場: TRENDING                                          │
│  💰 入場價格: 1.08500                                       │
│                                                             │
│  ───────────────────────────────────────────                │
│                                                             │
│  ⚠️ 請謹慎評估後再做交易決策                                │
│                                                             │
│  AIFX v2 Trading Signals                                   │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

#### LINE Bot 介面

**訊號查詢 Flex Message**

```
┌────────────────────────────────────────────────────────────┐
│  ╔══════════════════════════════════════════════════════╗  │
│  ║           📊 AIFX 交易訊號                           ║  │
│  ╠══════════════════════════════════════════════════════╣  │
│  ║                                                      ║  │
│  ║  EUR/USD                                             ║  │
│  ║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ║  │
│  ║                                                      ║  │
│  ║  🟢 買入 (LONG)                    信心度 75%       ║  │
│  ║                                                      ║  │
│  ║  週期: 周內 (1H)                                     ║  │
│  ║  強度: STRONG                                        ║  │
│  ║  市場: TRENDING                                      ║  │
│  ║                                                      ║  │
│  ╠══════════════════════════════════════════════════════╣  │
│  ║  📈 技術指標                                         ║  │
│  ║  SMA: 1.0845   RSI: 58.5                            ║  │
│  ║  MACD: +0.0012                                       ║  │
│  ╠══════════════════════════════════════════════════════╣  │
│  ║  💰 入場: 1.08500                                    ║  │
│  ║  🛑 停損: 1.08200                                    ║  │
│  ║  🎯 目標: 1.09000                                    ║  │
│  ╠══════════════════════════════════════════════════════╣  │
│  ║  ⚠️ 僅供參考，請自行評估風險                         ║  │
│  ╚══════════════════════════════════════════════════════╝  │
│                                                             │
│  [訂閱此貨幣對]  [查看其他]  [說明]                         │
│                                                             │
└────────────────────────────────────────────────────────────┘
```

#### Admin 管理後台介面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  AIFX Admin Dashboard v2                                        [_] [□] [X] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  登入                                                                 │   │
│  │  帳號: [admin________________]                                        │   │
│  │  密碼: [********************_]                                        │   │
│  │                                [  登入  ]                             │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  [系統監控]  [用戶管理]  [訊號管理]  [情緒分析]  [重新整理]                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  系統狀態                                                             │   │
│  │  ─────────────────────────────────────────────────────────────────   │   │
│  │                                                                       │   │
│  │  PostgreSQL    [●] 已連線        Redis         [●] 已連線            │   │
│  │  ML Engine     [●] 已連線        Sentiment     [●] 運行中            │   │
│  │                                                                       │   │
│  │  ─────────────────────────────────────────────────────────────────   │   │
│  │                                                                       │   │
│  │  統計資訊                                                             │   │
│  │  ─────────────────────────────────────────────────────────────────   │   │
│  │                                                                       │   │
│  │  總用戶數      156                 Discord 用戶     98               │   │
│  │  LINE 用戶     58                  今日訊號         24               │   │
│  │  活躍訂閱      87                  API 請求/分鐘    45               │   │
│  │                                                                       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  最後更新: 2025-12-03 14:30:00                                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 第三節 其他系統實測或實驗結果

### 3.3.1 API 效能測試結果

| 端點 | 平均回應時間 | P95 回應時間 | 每秒請求數 |
|------|-------------|--------------|------------|
| /health | 5ms | 10ms | 1000+ |
| /api/v1/trading/signal (快取命中) | 15ms | 30ms | 500+ |
| /api/v1/trading/signal (快取未命中) | 180ms | 250ms | 50+ |
| /api/v1/notifications/subscribe | 25ms | 50ms | 200+ |

### 3.3.2 ML 模型預測準確率

| 貨幣對 | 時間框架 | 準確率 | 測試期間 |
|--------|----------|--------|----------|
| EUR/USD | 1h | 57.3% | 2025-10 ~ 2025-11 |
| USD/JPY | 1h | 55.8% | 2025-10 ~ 2025-11 |
| GBP/USD | 1h | 56.1% | 2025-10 ~ 2025-11 |

*註：準確率以方向預測正確 (價格上漲/下跌) 為標準*

### 3.3.3 系統穩定性測試

| 指標 | 結果 | 說明 |
|------|------|------|
| 系統可用性 | 99.5% | 30 天監控期間 |
| 平均回應時間 | 85ms | 所有 API 端點平均 |
| 錯誤率 | 0.3% | HTTP 5xx 錯誤比例 |
| Redis 命中率 | 82% | 快取命中比例 |

---

# 第四章 結論

## 第一節 系統目標與特色

### 4.1.1 主要貢獻

1. **AI 驅動決策支援**
   - 整合 LSTM 深度學習與 NLP 情緒分析
   - 提供量化的交易訊號與信心度評估
   - 減少人為情緒對交易決策的影響

2. **多平台即時通知**
   - 同時支援 Discord 與 LINE 兩大通訊平台
   - 基於 Redis Pub/Sub 的即時推播架構
   - 訂閱機制實現個人化通知服務

3. **微服務架構設計**
   - 服務獨立部署與擴展
   - 明確的 API 邊界與認證機制
   - 高可用性與容錯能力

### 4.1.2 系統特色

| 特色 | 說明 |
|------|------|
| 多維度分析 | 技術分析 (LSTM) + 情緒分析 (FinBERT) 加權融合 |
| 自適應權重 | 根據時間框架動態調整技術/情緒分析權重 |
| 混合數據模式 | 資料庫 + API 混合查詢，節省 99% API 配額 |
| 冷卻機制 | 30 分鐘通知冷卻，避免過度打擾用戶 |
| 繁體中文支援 | Bot 指令與回應完整支援繁體中文 |

### 4.1.3 創新與優勢

1. **情緒分析融合**：不同於傳統純技術分析系統，本系統整合新聞情緒與央行政策分析，提供更全面的市場觀點

2. **時間框架自適應**：根據交易週期自動調整分析權重，短線重技術、長線重基本面

3. **即時通知架構**：基於 Redis Pub/Sub 的高效推播系統，訊號變化 5 秒內送達用戶

---

## 第二節 未來展望

### 4.2.1 短期規劃 (3-6 個月)

| 項目 | 說明 |
|------|------|
| 更多貨幣對 | 擴展至 10+ 主流貨幣對 |
| Web 前端 | 完成 React 前端開發 |
| 回測報告 | 提供用戶可視化回測績效報告 |
| 模型優化 | 引入 Transformer 架構提升預測準確率 |

### 4.2.2 中期規劃 (6-12 個月)

| 項目 | 說明 |
|------|------|
| 社群情緒 | 整合 Twitter/Reddit 社群情緒分析 |
| 個人化推薦 | 根據用戶交易歷史提供個人化建議 |
| 多資產類別 | 擴展至加密貨幣、股票市場 |
| Mobile App | 開發 iOS/Android 原生應用程式 |

### 4.2.3 長期願景

建立一個**全方位 AI 投資顧問平台**，涵蓋：
- 多資產類別（外匯、股票、加密貨幣）
- 多種分析模型（技術分析、基本面分析、情緒分析）
- 多種互動方式（Bot、Web、Mobile、API）
- 智能風險管理與資產配置建議

---

# 第五章 參考文獻

## 學術文獻

1. Hochreiter, S., & Schmidhuber, J. (1997). Long Short-Term Memory. *Neural Computation*, 9(8), 1735-1780.

2. Araci, D. (2019). FinBERT: Financial Sentiment Analysis with Pre-trained Language Models. *arXiv preprint arXiv:1908.10063*.

3. Hutto, C., & Gilbert, E. (2014). VADER: A Parsimonious Rule-Based Model for Sentiment Analysis of Social Media Text. *Proceedings of the International AAAI Conference on Web and Social Media*, 8(1).

4. Fischer, T., & Krauss, C. (2018). Deep learning with long short-term memory networks for financial market predictions. *European Journal of Operational Research*, 270(2), 654-669.

## 技術文件

5. TensorFlow Documentation. (2025). *Keras LSTM Layer*. https://www.tensorflow.org/api_docs/python/tf/keras/layers/LSTM

6. Discord.js Guide. (2025). *Creating Slash Commands*. https://discordjs.guide/creating-your-bot/slash-commands.html

7. LINE Developers. (2025). *Messaging API*. https://developers.line.biz/en/docs/messaging-api/

8. FastAPI Documentation. (2025). *FastAPI - Modern Python Web Framework*. https://fastapi.tiangolo.com/

9. Sequelize Documentation. (2025). *Sequelize ORM for Node.js*. https://sequelize.org/docs/v6/

10. Redis Documentation. (2025). *Pub/Sub*. https://redis.io/docs/manual/pubsub/

## 資料來源

11. Twelve Data. (2025). *Financial Market Data API*. https://twelvedata.com/docs

12. NewsAPI. (2025). *News API Documentation*. https://newsapi.org/docs

13. Google News RSS. (2025). *Google News RSS Feed*.

---

# 附錄

## 附錄 A：環境變數完整列表

```env
# ===== Backend =====
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://user:password@localhost:5432/aifx_db
REDIS_URL=redis://localhost:6379
JWT_SECRET=your-jwt-secret-min-32-chars
JWT_REFRESH_SECRET=your-refresh-secret
TWELVE_DATA_KEY=your-twelve-data-api-key
ML_API_URL=http://localhost:8000
API_KEY=your-64-char-discord-api-key
LINE_BOT_API_KEY=your-64-char-line-api-key
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-admin-password
ADMIN_JWT_SECRET=your-admin-jwt-secret

# ===== ML Engine =====
ML_ENGINE_PORT=8000
NEWS_API_KEY=your-newsapi-key
BACKEND_API_URL=http://localhost:3000

# ===== Discord Bot =====
DISCORD_BOT_TOKEN=your-discord-bot-token
DISCORD_CLIENT_ID=your-client-id
DISCORD_SIGNAL_CHANNEL_ID=your-channel-id

# ===== LINE Bot =====
LINE_CHANNEL_ACCESS_TOKEN=your-line-token
LINE_CHANNEL_SECRET=your-line-secret
```

## 附錄 B：API 端點完整列表

### Backend API (Port 3000)

| 路由 | 方法 | 認證 | 說明 |
|------|------|------|------|
| /health | GET | 無 | 健康檢查 |
| /api/v1/auth/login | POST | 無 | 用戶登入 |
| /api/v1/auth/register | POST | 無 | 用戶註冊 |
| /api/v1/trading/signal | GET | JWT | 查詢訊號 |
| /api/v1/discord/signals | GET | API Key | Discord 訊號 |
| /api/v1/line/signals | GET | Bearer | LINE 訊號 |
| /api/v1/notifications/subscribe | POST | API Key | 訂閱 |
| /api/v1/admin/login | POST | 無 | 管理員登入 |
| /api/v1/admin/stats | GET | Admin JWT | 統計資訊 |

### ML Engine API (Port 8000)

| 路由 | 方法 | 說明 |
|------|------|------|
| /health | GET | 健康檢查 |
| /predict | POST | LSTM 預測 |
| /sentiment/analyze | POST | 情緒分析 |
| /reversal/predict_raw | POST | 反轉預測 |

---

**文件版本**: 1.0
**最後更新**: 2025-12-03
**撰寫者**: AIFX 專題團隊
