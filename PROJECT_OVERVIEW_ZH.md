# 🎯 AIFX v2 專案功能說明與運作原理

**最後更新**: 2025-10-27
**狀態**: ✅ 全系統運行中

---

## 📖 這個專案是什麼？

**AIFX v2** 是一個**AI 驅動的外匯交易諮詢系統**，它會：

1. 🔍 **即時監控外匯市場**（歐元/美元、英鎊/美元等 12+ 貨幣對）
2. 🤖 **用 AI 和機器學習分析市場趨勢**
3. 💡 **生成交易建議**（買入/賣出/持有）
4. ⚠️ **提供風險管理建議**（停損點、獲利點）
5. 📊 **顯示詳細技術指標和圖表**
6. 🔔 **即時推送交易信號通知**

**簡單來說**：這是一個幫助交易者做決策的「智能交易助手」。

---

## 🎮 用戶可以幹嘛？

### 1️⃣ 查看市場概況 (Market Overview)
```
- 看到所有主要貨幣對的即時價格
- 查看 24 小時漲跌幅
- 看到每個貨幣對的趨勢（上漲/下跌/震盪）
```

**實際使用場景**:
```
用戶打開首頁 → 立刻看到：
EUR/USD: 1.0825 ▲ +0.15%  [趨勢: 上漲]
GBP/USD: 1.2650 ▼ -0.08%  [趨勢: 下跌]
USD/JPY: 149.50 ▲ +0.22%  [趨勢: 上漲]
```

---

### 2️⃣ 獲取交易信號 (Trading Signals)
```
- 針對特定貨幣對獲取買入/賣出建議
- 看到 AI 信心度（例如：75% 信心度買入）
- 獲得具體的進場價、停損價、獲利價
- 查看信號的理由（技術指標、AI 預測、市場情緒）
```

**實際使用場景**:
```
用戶問："EUR/USD 現在該買還是賣？"

系統回答：
┌───────────────────────────────────┐
│ EUR/USD 交易信號                   │
├───────────────────────────────────┤
│ 建議: 🟢 BUY (買入)                │
│ 信心度: 78% ⭐⭐⭐⭐               │
│ 進場價: 1.0825                    │
│ 停損價: 1.0785 (-40 pips)        │
│ 獲利價: 1.0905 (+80 pips)        │
│                                    │
│ 理由:                              │
│ • RSI 顯示超賣（34.2）            │
│ • MACD 黃金交叉（看漲信號）       │
│ • AI 預測未來 4 小時上漲概率 82% │
│ • 支撐位於 1.0790                 │
│                                    │
│ 風險提示:                          │
│ ⚠️ 風險/報酬比 1:2 (合理)         │
│ ⚠️ 建議倉位不超過帳戶 2%          │
└───────────────────────────────────┘
```

---

### 3️⃣ 查看詳細技術指標 (Technical Analysis)
```
- SMA (簡單移動平均線) - 看趨勢方向
- EMA (指數移動平均線) - 反應更靈敏
- RSI (相對強弱指標) - 判斷超買/超賣
- MACD (平滑異同移動平均線) - 抓買賣時機
- Bollinger Bands (布林通道) - 看價格波動範圍
```

**實際使用場景**:
```
用戶點擊 "EUR/USD 詳細分析"

系統顯示圖表：
📊 價格走勢圖
📈 SMA(20): 1.0810  SMA(50): 1.0795
📈 RSI: 34.2 [超賣區域 ⚠️]
📈 MACD: 看漲交叉 🟢
📈 布林通道: 價格接近下軌（可能反彈）
```

---

### 4️⃣ 查看歷史表現 (Performance Tracking)
```
- 查看過去 7 天、30 天、90 天的信號表現
- 看到勝率（例如：過去 30 天勝率 72%）
- 查看最佳/最差交易
- 追蹤總盈虧
```

**實際使用場景**:
```
用戶問："這個系統準不準？"

系統顯示：
過去 30 天表現:
- 總信號數: 156
- 成功信號: 112 ✅
- 失敗信號: 44 ❌
- 勝率: 71.8%
- 總盈利: +1,245 pips
- 最大回撤: -180 pips

最佳交易: EUR/USD 買入 (+125 pips)
最差交易: GBP/USD 賣出 (-65 pips)
```

---

### 5️⃣ 個性化設定 (Personalization)
```
- 設定交易風格（當沖/短線/中長線）
- 設定風險容忍度（1-10 級）
- 選擇關注的貨幣對
- 自訂技術指標參數
```

**實際使用場景**:
```
用戶設定：
- 交易頻率: 當沖 (Scalping)
- 風險等級: 5/10 (中等)
- 關注貨幣對: EUR/USD, GBP/USD
- 偏好策略: 趨勢跟隨

系統會根據這些設定調整：
→ 只推送短期（1-4 小時）信號
→ 停損設置較緊（15-30 pips）
→ 只通知 EUR/USD 和 GBP/USD
→ 優先推送趨勢突破信號
```

---

### 6️⃣ 即時通知 (Real-time Notifications)
```
- 瀏覽器推送通知
- Discord 機器人通知（如果有設定）
- Email 通知（重要信號）
```

**實際使用場景**:
```
用戶正在做其他事...

突然收到通知：
🔔 [高信心度信號] EUR/USD 買入機會
   信心度: 85%
   進場價: 1.0830
   目標: 1.0910 (+80 pips)
   停損: 1.0790 (-40 pips)
   
   [查看詳情] [忽略]
```

---

## 🤖 系統怎麼運作的？

### 架構圖解

```
┌─────────────┐
│   用戶打開   │ 
│  瀏覽器網頁  │ http://localhost:5173
└──────┬──────┘
       │
       ▼
┌──────────────────────────────────────┐
│         前端 (React + Vite)           │
│  • 登錄頁面                           │
│  • 市場總覽儀表板                      │
│  • 交易信號列表                        │
│  • 圖表和技術指標                      │
│  • 用戶設定                           │
└──────┬───────────────────────────────┘
       │ HTTP API 請求
       │ WebSocket 即時連線
       ▼
┌──────────────────────────────────────┐
│      後端 (Node.js + Express)         │
│  Port 3000                            │
│                                       │
│  主要功能:                            │
│  ✅ 用戶認證 (JWT Token)              │
│  ✅ API 路由處理                      │
│  ✅ 外匯數據獲取 (Alpha Vantage)     │
│  ✅ 技術指標計算                      │
│  ✅ 交易信號生成                      │
│  ✅ WebSocket 即時推送                │
└──────┬───────────┬─────────┬─────────┘
       │           │         │
       ▼           ▼         ▼
┌─────────────┐ ┌─────────┐ ┌────────────┐
│ PostgreSQL  │ │  Redis  │ │ ML Engine  │
│ 數據庫      │ │  快取   │ │ Python     │
│ Port 5432   │ │ Port    │ │ Port 8000  │
│             │ │ 6379    │ │            │
│ 儲存:       │ │         │ │ 提供:      │
│ • 用戶資料  │ │ 快取:   │ │ • AI 預測  │
│ • 交易信號  │ │ • 市場  │ │ • LSTM 模型│
│ • 歷史記錄  │ │   數據  │ │ • 價格預測 │
│ • 通知記錄  │ │ • 用戶  │ │ • 趨勢分析 │
│ • 用戶偏好  │ │   會話  │ │            │
└─────────────┘ └─────────┘ └────────────┘
```

---

## 🔄 完整工作流程

### 場景 1: 用戶登錄並查看信號

```
1. 用戶打開瀏覽器 → http://localhost:5173

2. 前端顯示登錄頁面

3. 用戶輸入:
   Email: john@example.com
   Password: Password123!

4. 前端發送請求 → Backend API
   POST /api/v1/auth/login
   {
     "identifier": "john@example.com",
     "password": "Password123!"
   }

5. Backend 驗證:
   → 從 PostgreSQL 查詢用戶
   → 用 bcrypt 驗證密碼
   → 生成 JWT Token
   → 儲存 session 到 Redis

6. 返回給前端:
   {
     "success": true,
     "data": {
       "token": "eyJhbGciOiJIUzI1NiIs...",
       "user": {
         "id": 1,
         "username": "john_trader",
         "email": "john@example.com"
       }
     }
   }

7. 前端儲存 Token，跳轉到儀表板

8. 前端自動請求:
   GET /api/v1/market/overview
   GET /api/v1/trading/signals

9. Backend 處理:
   → 檢查 Redis 快取
   → 如果快取過期，向 Alpha Vantage API 請求數據
   → 計算技術指標（RSI, MACD, SMA...）
   → 呼叫 ML Engine 獲取 AI 預測
   → 生成交易信號
   → 儲存到 PostgreSQL
   → 快取結果到 Redis (TTL 60 秒)

10. 返回數據給前端，顯示在儀表板
```

---

### 場景 2: 用戶請求特定貨幣對的信號

```
1. 用戶點擊 "獲取 EUR/USD 信號"

2. 前端發送:
   GET /api/v1/trading/signal/EURUSD?timeframe=1h

3. Backend 處理流程:

   Step 1: 獲取市場數據
   ──────────────────────────
   → forexService.getHistoricalData('EURUSD', '1h', 100)
   → 呼叫 Alpha Vantage API
   → 獲取最近 100 根 K 線數據
   
   返回數據示例:
   [
     { time: '2025-10-27 09:00', open: 1.0820, high: 1.0835, low: 1.0815, close: 1.0830, volume: 15234 },
     { time: '2025-10-27 10:00', open: 1.0830, high: 1.0845, low: 1.0825, close: 1.0840, volume: 18921 },
     ...
   ]

   Step 2: 計算技術指標
   ──────────────────────────
   → technicalIndicators.calculateSMA(prices, 20)  // 20 期 SMA
   → technicalIndicators.calculateRSI(prices, 14)  // 14 期 RSI
   → technicalIndicators.calculateMACD(prices)     // MACD
   → technicalIndicators.calculateBollingerBands(prices, 20, 2)
   
   返回:
   {
     sma20: 1.0815,
     sma50: 1.0800,
     rsi: 34.2,
     macd: { value: 0.0012, signal: 0.0008, histogram: 0.0004 },
     bollingerBands: { upper: 1.0880, middle: 1.0820, lower: 1.0760 }
   }

   Step 3: 呼叫 ML Engine
   ──────────────────────────
   → HTTP POST http://localhost:8000/predict
   → 發送: { pair: 'EURUSD', timeframe: '1h', data: [...] }
   
   ML Engine 處理:
   ├─ 載入 LSTM 模型 (forex_model_v1.0.0.h5)
   ├─ 標準化輸入數據
   ├─ 運行神經網絡預測
   └─ 返回預測結果
   
   返回:
   {
     "prediction": "buy",
     "confidence": 0.82,
     "predicted_price": 1.0910,
     "timeframe": "4h",
     "factors": {
       "technical": 0.75,
       "pattern": 0.88,
       "momentum": 0.79
     }
   }

   Step 4: 生成交易信號
   ──────────────────────────
   tradingSignalService.generateSignal() 綜合:
   ├─ 技術指標分析 (40% 權重)
   ├─ ML 預測 (40% 權重)
   └─ 市場情緒 (20% 權重)
   
   決策邏輯:
   IF RSI < 40 AND MACD 看漲 AND ML 預測 "buy" AND 信心度 > 70%
      → 生成 BUY 信號
      → 計算停損: 當前價格 - (ATR * 1.5)
      → 計算獲利: 當前價格 + (ATR * 3.0)
   
   生成信號:
   {
     pair: 'EURUSD',
     action: 'BUY',
     confidence: 0.78,
     entry_price: 1.0825,
     stop_loss: 1.0785,
     take_profit: 1.0905,
     timeframe: '1h',
     reasoning: [
       'RSI 顯示超賣 (34.2)',
       'MACD 黃金交叉',
       'AI 預測 4 小時上漲概率 82%',
       '支撐位於 1.0790'
     ],
     risk_reward_ratio: 2.0,
     risk_level: 5
   }

   Step 5: 儲存到數據庫
   ──────────────────────────
   → INSERT INTO trading_signals (...)
   → 記錄到 PostgreSQL 供歷史追蹤

   Step 6: 推送即時通知
   ──────────────────────────
   → 透過 WebSocket 推送給所有訂閱的用戶
   → 如果是高信心度信號 (>80%)，發送瀏覽器通知

4. 前端接收並顯示信號
```

---

## 🧠 AI/ML 引擎做了什麼？

### ML Engine 的工作

```python
# ML Engine 主要功能

1. 價格預測 (LSTM 神經網絡)
   ────────────────────────
   輸入: 
   - 過去 60 根 K 線數據
   - 技術指標（RSI, MACD, SMA...）
   - 成交量
   
   模型: 
   - 3 層 LSTM (128, 64, 32 neurons)
   - 2 層 Dense 
   - Dropout 防止過擬合
   
   輸出:
   - 預測未來價格（1h, 4h, 1d）
   - 漲跌概率
   - 信心度

2. 趨勢反轉檢測
   ────────────────────────
   識別市場即將反轉的信號
   - 雙頂/雙底
   - 頭肩頂/頭肩底
   - 背離形態

3. 模式識別
   ────────────────────────
   識別常見的 K 線形態
   - 看漲吞沒
   - 看跌吞沒
   - 錘子線
   - 射擊之星

4. 情緒分析（未來功能）
   ────────────────────────
   分析市場情緒
   - 新聞情緒
   - 社交媒體情緒
```

---

## 📊 數據流向圖

```
外部數據源
    │
    ├─ Alpha Vantage API (主要)
    │  • 外匯即時報價
    │  • 歷史 K 線數據
    │  • 技術指標數據
    │
    └─ yfinance (備用，免費)
       • 市場數據
       • 歷史數據
    
    ▼
    
Backend 數據處理
    │
    ├─ 數據清洗
    ├─ 數據標準化
    ├─ 技術指標計算
    │
    ▼
    
儲存到 Redis (快取 60 秒)
    │
    ▼
    
ML Engine 分析
    │
    ├─ LSTM 預測
    ├─ 模式識別
    └─ 趨勢分析
    
    ▼
    
交易信號生成
    │
    ├─ 綜合分析
    ├─ 風險計算
    └─ 信心度評分
    
    ▼
    
儲存到 PostgreSQL (持久化)
    │
    ▼
    
WebSocket 推送 + Frontend 顯示
    │
    └─ 用戶收到信號
```

---

## 🔐 安全性設計

```
1. 用戶認證
   ──────────────
   • JWT Token (有效期 24 小時)
   • Refresh Token (有效期 7 天)
   • bcrypt 密碼加密 (10 rounds)

2. API 安全
   ──────────────
   • Rate Limiting (100 req/15 min)
   • Helmet.js 安全標頭
   • CORS 限制
   • 輸入驗證 (Joi)

3. 數據安全
   ──────────────
   • 敏感數據加密儲存
   • SQL 注入防護 (Sequelize ORM)
   • XSS 防護
   • CSRF Token
```

---

## 📈 性能優化

```
1. 快取策略
   ──────────────
   • Redis 快取市場數據 (TTL 60s)
   • Redis 快取用戶 session
   • Redis 快取技術指標計算結果

2. 數據庫優化
   ──────────────
   • PostgreSQL 索引優化
   • Connection pooling
   • Query 優化

3. API 優化
   ──────────────
   • 限制外部 API 調用頻率
   • 批量請求
   • 分頁查詢
```

---

## 🎯 實際使用範例

### 範例 1: 新手用戶

```
David 是外匯新手，想要學習交易

1. 註冊帳號
2. 設定:
   - 交易頻率: 波段交易 (Swing)
   - 風險等級: 3/10 (保守)
   - 關注: EUR/USD, USD/JPY

3. 每天早上 9:00
   → 系統推送 1-2 個高信心度信號
   → David 查看詳細分析
   → 學習為什麼系統這樣建議

4. 一個月後
   → David 查看歷史表現
   → 學到哪些信號成功率高
   → 逐漸建立自己的交易策略
```

---

### 範例 2: 進階交易者

```
Sarah 是經驗豐富的交易者

1. 登入系統
2. 設定:
   - 交易頻率: 當沖 (Scalping)
   - 風險等級: 8/10 (激進)
   - 關注: 所有主要貨幣對
   - 自訂 RSI 參數: 10 (更靈敏)

3. 交易時段
   → 即時監控儀表板
   → 收到信號後快速判斷
   → 結合自己的分析
   → 執行交易

4. 使用場景
   → 系統作為「第二意見」
   → 避免情緒化交易
   → 驗證自己的交易想法
```

---

## 🚦 系統目前狀態

```
✅ 已完成功能
──────────────────────
✅ 用戶註冊/登錄
✅ 市場數據獲取
✅ 技術指標計算
✅ 基礎交易信號生成
✅ ML 價格預測 (LSTM)
✅ WebSocket 即時推送
✅ 用戶偏好設定
✅ 歷史信號追蹤

⏳ 進行中
──────────────────────
🔨 Discord Bot 整合
🔨 Email 通知
🔨 進階圖表功能
🔨 更多 ML 模型訓練

📝 計劃中
──────────────────────
📋 情緒分析功能
📋 新聞事件監控
📋 社交交易功能
📋 模擬交易帳戶
```

---

## 💡 總結

**AIFX v2 是什麼？**
一個 AI 驅動的外匯交易助手系統

**它能做什麼？**
- 即時監控市場
- 生成交易信號
- 提供技術分析
- AI 價格預測
- 風險管理建議

**誰適合用？**
- ✅ 外匯新手（學習工具）
- ✅ 進階交易者（輔助決策）
- ✅ 量化交易者（信號來源）

**核心價值**
- 🎯 提高決策品質
- ⏱️ 節省分析時間
- 📊 數據驅動交易
- ⚠️ 降低情緒影響

---

**⚠️ 重要聲明**:
此系統僅提供諮詢建議，不構成投資建議。
外匯交易具有高風險，請謹慎投資，切勿投入超過可承受損失的資金。

---

📞 **現在就試試看**:
```bash
# 訪問系統
http://localhost:5173

# 測試帳號
Email: john@example.com
Password: Password123!
```

