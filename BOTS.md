# AIFX v2 - Bot æœå‹™èªªæ˜
# Discord Bot & LINE Bot

æœ¬æ–‡ä»¶èªªæ˜ AIFX v2 çš„ Bot æœå‹™æ¶æ§‹èˆ‡åŠŸèƒ½ã€‚

---

## æ¦‚è¿°

AIFX v2 æä¾›å…©ç¨® Bot æœå‹™ï¼Œè®“ç”¨æˆ¶é€éç†Ÿæ‚‰çš„é€šè¨Šå¹³å°ç²å–äº¤æ˜“è¨Šè™Ÿï¼š

| Bot | æŠ€è¡“ | ç«¯å£ | ç‰¹è‰² |
|-----|------|------|------|
| Discord Bot | Discord.js 14 | - | æ–œç·šå‘½ä»¤ã€Embed è¨Šæ¯ |
| LINE Bot | LINE Bot SDK 8 | 3001 | Flex Messageã€ä¸­æ–‡æŒ‡ä»¤ |

---

## æ¶æ§‹

```
ç”¨æˆ¶
  â”‚
  â”œâ”€â”€ Discord App â”€â”€â–º Discord Bot â”€â”€â”
  â”‚                                  â”‚
  â””â”€â”€ LINE App â”€â”€â”€â”€â”€â–º LINE Bot â”€â”€â”€â”€â”€â”¼â”€â”€â–º Backend API (Port 3000)
                     (Port 3001)    â”‚         â”‚
                                    â”‚         â–¼
                                    â”‚    PostgreSQL
                                    â”‚
                                    â””â”€â”€â–º Redis Pub/Sub
                                         (ä¿¡è™Ÿè®ŠåŒ–é€šçŸ¥)
```

**é‡è¦è¦å‰‡**ï¼š
- Bot ä¸ç›´æ¥å­˜å–è³‡æ–™åº«
- æ‰€æœ‰è³‡æ–™æ“ä½œé€é Backend API
- ä½¿ç”¨ API Key èªè­‰

---

## Discord Bot

### ç›®éŒ„çµæ§‹

```
discord_bot/
â”œâ”€â”€ bot.js              # ä¸»ç¨‹å¼å…¥å£
â”œâ”€â”€ deploy-commands.js  # éƒ¨ç½²æ–œç·šå‘½ä»¤
â”œâ”€â”€ commands/           # æ–œç·šå‘½ä»¤
â”‚   â”œâ”€â”€ signal.js       # æŸ¥è©¢äº¤æ˜“è¨Šè™Ÿ
â”‚   â”œâ”€â”€ subscribe.js    # è¨‚é–±é€šçŸ¥
â”‚   â”œâ”€â”€ unsubscribe.js  # å–æ¶ˆè¨‚é–±
â”‚   â”œâ”€â”€ subscriptions.js# æŸ¥çœ‹è¨‚é–±åˆ—è¡¨
â”‚   â”œâ”€â”€ position.js     # æŒå€‰å»ºè­°
â”‚   â”œâ”€â”€ preferences.js  # äº¤æ˜“åå¥½è¨­å®š
â”‚   â”œâ”€â”€ trading-guide.js# äº¤æ˜“æŒ‡å—
â”‚   â””â”€â”€ ping.js         # é€£ç·šæ¸¬è©¦
â”œâ”€â”€ services/           # æœå‹™å±¤
â”‚   â””â”€â”€ backendClient.js# Backend API å®¢æˆ¶ç«¯
â”œâ”€â”€ utils/              # å·¥å…·å‡½å¼
â””â”€â”€ ecosystem.config.js # PM2 é…ç½®
```

### æŒ‡ä»¤èªªæ˜

| æŒ‡ä»¤ | åƒæ•¸ | èªªæ˜ |
|------|------|------|
| `/signal` | `[è²¨å¹£å°]` `[é€±æœŸ]` | æŸ¥è©¢äº¤æ˜“è¨Šè™Ÿ |
| `/subscribe` | `[è²¨å¹£å°]` `[æ™‚é–“æ¡†æ¶]` | è¨‚é–±ä¿¡è™Ÿè®ŠåŒ–é€šçŸ¥ |
| `/unsubscribe` | `[è²¨å¹£å°]` `[æ™‚é–“æ¡†æ¶]` | å–æ¶ˆè¨‚é–± |
| `/subscriptions` | - | æŸ¥çœ‹æ‰€æœ‰è¨‚é–± |
| `/trading-guide` | - | é¡¯ç¤ºäº¤æ˜“æŒ‡å— |
| `/ping` | - | æ¸¬è©¦ Bot é€£ç·š |

### é€±æœŸåƒæ•¸

| é€±æœŸ | æ™‚é–“æ¡†æ¶ | èªªæ˜ |
|------|----------|------|
| æ—¥å…§ (intraday) | 15min | ç•¶æ—¥äº¤æ˜“ |
| å‘¨å…§ (swing) | 1h | æ³¢æ®µäº¤æ˜“ |
| æœˆå…§ (position) | 1d | ä¸­æœŸæŠ•è³‡ |
| å­£å…§ (longterm) | 1w | é•·æœŸæŠ•è³‡ |

### ç’°å¢ƒè®Šæ•¸

```env
DISCORD_BOT_TOKEN=your-bot-token
DISCORD_CLIENT_ID=your-client-id
BACKEND_API_URL=http://localhost:3000
API_KEY=your-64-char-api-key
REDIS_URL=redis://localhost:6379
```

### å•Ÿå‹•æ–¹å¼

```bash
# é–‹ç™¼ç’°å¢ƒ
cd discord_bot
node bot.js

# éƒ¨ç½²æ–œç·šå‘½ä»¤ (é¦–æ¬¡æˆ–æ›´æ–°æ™‚)
node deploy-commands.js

# æ­£å¼ç’°å¢ƒ (PM2)
pm2 start ecosystem.config.js
```

### è¨Šè™Ÿæ¨é€æ ¼å¼

Discord ä½¿ç”¨ Embed è¨Šæ¯æ ¼å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š AIFX äº¤æ˜“è¨Šè™Ÿ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è²¨å¹£å°ï¼šEUR/USD                â”‚
â”‚ æ–¹å‘ï¼šğŸŸ¢ è²·å…¥ (LONG)           â”‚
â”‚ ä¿¡å¿ƒåº¦ï¼š75%                    â”‚
â”‚ å¼·åº¦ï¼šSTRONG                   â”‚
â”‚ é€±æœŸï¼šå‘¨å…§ (1H)                â”‚
â”‚ å¸‚å ´ç‹€æ³ï¼šTRENDING             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ åƒ…ä¾›åƒè€ƒï¼Œè«‹è‡ªè¡Œè©•ä¼°é¢¨éšª    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## LINE Bot

### ç›®éŒ„çµæ§‹

```
line_bot/
â”œâ”€â”€ bot.js              # ä¸»ç¨‹å¼å…¥å£ (Express Webhook)
â”œâ”€â”€ handlers/
â”‚   â””â”€â”€ messageHandler.js  # è¨Šæ¯è™•ç†é‚è¼¯
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ backendClient.js   # Backend API å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ messageBuilder.js  # Flex Message å»ºæ§‹å™¨
â”œâ”€â”€ config/             # é…ç½®æª”
â”œâ”€â”€ utils/              # å·¥å…·å‡½å¼
â””â”€â”€ ecosystem.config.js # PM2 é…ç½®
```

### æŒ‡ä»¤èªªæ˜

| æŒ‡ä»¤ | ç¯„ä¾‹ | èªªæ˜ |
|------|------|------|
| æŸ¥è©¢è¨Šè™Ÿ | `EUR/USD` | æŸ¥è©¢é è¨­é€±æœŸè¨Šè™Ÿ |
| æŸ¥è©¢ç‰¹å®šé€±æœŸ | `EUR/USD å‘¨å…§` | æŸ¥è©¢æŒ‡å®šé€±æœŸè¨Šè™Ÿ |
| è¨‚é–± | `è¨‚é–± EUR/USD` | è¨‚é–±ä¿¡è™Ÿè®ŠåŒ–é€šçŸ¥ |
| è¨‚é–±æŒ‡å®šæ¡†æ¶ | `è¨‚é–± EUR/USD 1h` | è¨‚é–±æŒ‡å®šæ™‚é–“æ¡†æ¶ |
| å–æ¶ˆè¨‚é–± | `å–æ¶ˆè¨‚é–± EUR/USD` | å–æ¶ˆè¨‚é–± |
| æŸ¥çœ‹è¨‚é–± | `æˆ‘çš„è¨‚é–±` | æŸ¥çœ‹æ‰€æœ‰è¨‚é–± |
| å¹«åŠ© | `å¹«åŠ©` | é¡¯ç¤ºæŒ‡ä»¤èªªæ˜ |

**æ”¯æ´ä¸­è‹±æ–‡æŒ‡ä»¤**ï¼š
- ä¸­æ–‡ï¼šè¨‚é–±ã€å–æ¶ˆè¨‚é–±ã€æˆ‘çš„è¨‚é–±
- è‹±æ–‡ï¼šsubscribeã€unsubscribeã€subscriptions

### ç’°å¢ƒè®Šæ•¸

```env
LINE_CHANNEL_ACCESS_TOKEN=your-channel-token
LINE_CHANNEL_SECRET=your-channel-secret
BACKEND_API_URL=http://localhost:3000
LINE_BOT_API_KEY=your-64-char-api-key
REDIS_URL=redis://localhost:6379
PORT=3001
```

### å•Ÿå‹•æ–¹å¼

```bash
# é–‹ç™¼ç’°å¢ƒ
cd line_bot
node bot.js

# æ­£å¼ç’°å¢ƒ (PM2)
pm2 start ecosystem.config.js
```

### Webhook è¨­å®š

LINE Bot éœ€è¦è¨­å®š Webhook URLï¼š

1. å‰å¾€ [LINE Developers Console](https://developers.line.biz/)
2. é¸æ“‡ä½ çš„ Channel
3. è¨­å®š Webhook URLï¼š`https://your-domain.com/webhook`
4. é–‹å•Ÿ "Use webhook"

**é–‹ç™¼ç’°å¢ƒ**å¯ä½¿ç”¨ ngrokï¼š
```bash
ngrok http 3001
# å°‡ç”¢ç”Ÿçš„ URL è¨­å®šç‚º Webhook URL
```

### Flex Message æ ¼å¼

LINE ä½¿ç”¨ Flex Message å‘ˆç¾è±å¯Œçš„å¡ç‰‡ UIï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š AIFX äº¤æ˜“è¨Šè™Ÿ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EUR/USD                        â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚ ğŸŸ¢ è²·å…¥ (LONG)      ä¿¡å¿ƒåº¦ 75% â”‚
â”‚                                â”‚
â”‚ é€±æœŸï¼šå‘¨å…§ (1H)                â”‚
â”‚ å¼·åº¦ï¼šSTRONG                   â”‚
â”‚ å¸‚å ´ï¼šTRENDING                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ æŠ€è¡“æŒ‡æ¨™                    â”‚
â”‚ SMA: 1.0850  RSI: 45           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ åƒ…ä¾›åƒè€ƒï¼Œè«‹è‡ªè¡Œè©•ä¼°é¢¨éšª    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¨‚é–±é€šçŸ¥ç³»çµ±

### é‹ä½œæµç¨‹

```
1. ç”¨æˆ¶è¼¸å…¥ "è¨‚é–± EUR/USD"
         â”‚
         â–¼
2. Bot å‘¼å« Backend API å»ºç«‹è¨‚é–±
         â”‚
         â–¼
3. Backend å„²å­˜åˆ° user_subscriptions è¡¨
         â”‚
         â–¼
4. Backend ä¿¡è™Ÿç›£æ§æœå‹™ (æ¯ 15 åˆ†é˜)
         â”‚
         â–¼
5. åµæ¸¬åˆ°ä¿¡è™Ÿè®ŠåŒ–
         â”‚
         â–¼
6. ç™¼å¸ƒ Redis 'signal-change' äº‹ä»¶
         â”‚
         â–¼
7. Bot æ¥æ”¶äº‹ä»¶ï¼Œæ¨é€é€šçŸ¥çµ¦è¨‚é–±ç”¨æˆ¶
```

### Redis Pub/Sub äº‹ä»¶æ ¼å¼

```json
{
  "pair": "EUR/USD",
  "timeframe": "1h",
  "oldSignal": "hold",
  "newSignal": "long",
  "confidence": 0.75,
  "signalStrength": "strong",
  "marketCondition": "trending",
  "entryPrice": 1.0850,
  "subscribers": [
    { "platform": "discord", "userId": "123456789" },
    { "platform": "line", "userId": "U1234567890abcdef" }
  ]
}
```

### å†·å»æ©Ÿåˆ¶

- åŒä¸€ç”¨æˆ¶/è²¨å¹£å°ï¼Œ30 åˆ†é˜å…§åªç™¼é€ä¸€æ¬¡é€šçŸ¥
- é˜²æ­¢éåº¦é€šçŸ¥å¹²æ“¾ç”¨æˆ¶

---

## API èªè­‰

### Discord Bot

```javascript
// ä½¿ç”¨ X-API-Key Header
const response = await axios.get(`${BACKEND_URL}/api/v1/discord/signals`, {
  headers: {
    'X-API-Key': process.env.API_KEY
  }
});
```

### LINE Bot

```javascript
// ä½¿ç”¨ Bearer Token
const response = await axios.get(`${BACKEND_URL}/api/v1/line/signals`, {
  headers: {
    'Authorization': `Bearer ${process.env.LINE_BOT_API_KEY}`
  }
});
```

---

## å¥åº·æª¢æŸ¥

### Discord Bot
```bash
# æª¢æŸ¥ Bot æ˜¯å¦åœ¨ç·š
# åœ¨ Discord è¼¸å…¥ /ping
```

### LINE Bot
```bash
curl http://localhost:3001/health
# å›æ‡‰ï¼š{"status":"healthy","service":"line-bot","version":"1.0.0"}
```

---

## å¸¸è¦‹å•é¡Œ

### Q1: Discord Bot æŒ‡ä»¤æ²’æœ‰å‡ºç¾ï¼Ÿ
åŸ·è¡Œ `node deploy-commands.js` éƒ¨ç½²æ–œç·šå‘½ä»¤ã€‚

### Q2: LINE Bot æ”¶ä¸åˆ°è¨Šæ¯ï¼Ÿ
1. ç¢ºèª Webhook URL è¨­å®šæ­£ç¢º
2. ç¢ºèª Channel Access Token æœ‰æ•ˆ
3. æª¢æŸ¥ `PORT=3001` æ˜¯å¦è¢«ä½”ç”¨

### Q3: è¨‚é–±å¾Œæ”¶ä¸åˆ°é€šçŸ¥ï¼Ÿ
1. ç¢ºèª Redis æœå‹™é‹è¡Œä¸­
2. ç¢ºèª Backend ä¿¡è™Ÿç›£æ§æœå‹™é‹è¡Œä¸­
3. æª¢æŸ¥è¨‚é–±æ˜¯å¦æˆåŠŸå»ºç«‹

---

**æœ€å¾Œæ›´æ–°**: 2025-12-02
