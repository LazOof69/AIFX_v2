# AIFX v2 系統概述文檔

**文檔版本**: 1.0
**生成日期**: 2025-11-20
**系統版本**: AIFX v2.0
**文檔類型**: 系統概述與功能說明

---

## 📑 目錄

1. [系統簡介](#1-系統簡介)
2. [系統服務範圍](#2-系統服務範圍)
3. [使用者需求分析](#3-使用者需求分析)
4. [系統功能架構圖](#4-系統功能架構圖)
5. [核心功能說明](#5-核心功能說明)
6. [技術規格](#6-技術規格)

---

## 1. 系統簡介

### 1.1 系統概述

**AIFX v2 (AI-Powered Forex Trading Advisory System)** 是一個基於人工智慧的外匯交易諮詢系統，旨在為外匯交易者提供即時、準確且個性化的交易建議。系統結合了機器學習、技術分析和情緒分析，為使用者提供高信心度的交易信號。

### 1.2 核心價值

| 核心特性 | 說明 | 指標 |
|---------|------|------|
| ⚡ **準確性** | 基於多因子分析的交易信號 | >70% 信心度 |
| 🔄 **即時性** | WebSocket 即時推送信號 | <100ms 延遲 |
| 🎯 **個性化** | 根據使用者風險承受度客製化 | 10 級風險調整 |
| 📊 **透明度** | 提供信號生成的技術因素說明 | 完整分析報告 |
| 🌐 **多平台** | Web + Discord 多渠道服務 | 2+ 介面 |

### 1.3 系統定位

```
┌─────────────────────────────────────────────────────────┐
│                      外匯交易市場                          │
├─────────────────────────────────────────────────────────┤
│                                                           │
│   數據供應商          AIFX v2 系統          交易者         │
│   (Market Data)   →  (AI Advisory)    →   (Traders)     │
│                                                           │
│   • Alpha Vantage    • AI 分析引擎         • 新手交易者    │
│   • Twelve Data      • 信號生成系統        • 專業交易者    │
│   • Yahoo Finance    • 風險管理工具        • 機構投資者    │
│                      • 通知服務                           │
└─────────────────────────────────────────────────────────┘
```

### 1.4 系統目標

1. **降低交易門檻**: 讓新手交易者也能獲得專業級的交易建議
2. **提升交易效率**: 自動化技術分析，節省人工分析時間
3. **風險管理**: 提供止損/止盈建議，控制交易風險
4. **持續學習**: 透過機器學習不斷優化信號準確度
5. **多渠道服務**: 透過 Web 和 Discord 隨時隨地接收信號

---

## 2. 系統服務範圍

### 2.1 服務對象

#### 2.1.1 主要使用者群體

| 使用者類型 | 特徵 | 使用目的 | 系統服務 |
|-----------|------|---------|---------|
| 🆕 **新手交易者** | 交易經驗 < 1 年 | 學習交易、獲取建議 | 基礎信號、教育資源 |
| 💼 **專業交易者** | 交易經驗 1-5 年 | 輔助決策、驗證策略 | 高級分析、自訂配置 |
| 🏢 **機構投資者** | 專業機構 | 量化分析、風險管理 | API 整合、批量分析 |
| 📱 **行動交易者** | 頻繁移動 | 隨時接收信號 | Discord 推送、移動端 |

#### 2.1.2 使用者地理分布

- 🌍 **全球服務**: 支援全天候 24/5 外匯市場
- 🌏 **亞洲市場**: 主要使用者群（GMT+8 時區優化）
- 🇺🇸 **美洲市場**: 美元交易對重點支援
- 🇪🇺 **歐洲市場**: 歐元交易對專業分析

### 2.2 服務內容

#### 2.2.1 交易信號服務

| 服務項目 | 說明 | 頻率 | 覆蓋範圍 |
|---------|------|------|---------|
| 📈 **即時信號** | 買入/賣出/持有建議 | 即時 | 12+ 貨幣對 |
| 🎯 **信心評分** | 信號可靠度評估 | 每次信號 | 0.0-1.0 分數 |
| 🛡️ **風險管理** | 止損/止盈點位 | 每次信號 | 自動計算 |
| 📊 **技術分析** | 指標數值與趨勢 | 每次信號 | 5+ 指標 |
| 🤖 **AI 預測** | 機器學習價格預測 | 每 15 分鐘 | 反轉檢測 |

#### 2.2.2 市場數據服務

```
市場數據服務層級
├── 即時價格 (Real-time Prices)
│   ├── Bid/Ask 價格
│   ├── 買賣價差
│   └── 成交量
│
├── 歷史數據 (Historical Data)
│   ├── 1 分鐘 K 線
│   ├── 5 分鐘 K 線
│   ├── 15 分鐘 K 線
│   ├── 1 小時 K 線
│   ├── 4 小時 K 線
│   ├── 日線
│   └── 週線
│
└── 技術指標 (Technical Indicators)
    ├── SMA (簡單移動平均)
    ├── RSI (相對強弱指標)
    ├── MACD (移動平均收斂發散)
    ├── Bollinger Bands (布林通道)
    └── 自訂指標組合
```

#### 2.2.3 通知服務

| 通知渠道 | 類型 | 延遲 | 適用場景 |
|---------|------|------|---------|
| 🌐 **Web 推送** | WebSocket | <100ms | 即時交易 |
| 💬 **Discord Bot** | 訊息推送 | <500ms | 社群通知 |
| 📧 **電子郵件** | SMTP | <5s | 報告摘要 |
| 📱 **瀏覽器通知** | Push API | <1s | 重要信號 |

#### 2.2.4 個性化服務

```
個性化配置選項
├── 交易偏好 (Trading Preferences)
│   ├── 交易頻率: 超短線/日內/波段/長線
│   ├── 風險等級: 1-10 級
│   ├── 偏好貨幣對: 多選
│   └── 交易風格: 趨勢/反趨勢/混合
│
├── 指標配置 (Indicator Settings)
│   ├── SMA 週期: 可調整
│   ├── RSI 週期: 可調整
│   ├── MACD 參數: 可調整
│   └── 信心閾值: 可設定
│
└── 通知設定 (Notification Settings)
    ├── 信號類型過濾
    ├── 信心度閾值
    ├── 通知頻率限制
    └── 推送時段設定
```

### 2.3 服務覆蓋的貨幣對

| 類別 | 貨幣對 | 說明 |
|------|-------|------|
| 🌟 **主要貨幣對** | EUR/USD, GBP/USD, USD/JPY | 流動性最高 |
| 💎 **交叉貨幣對** | EUR/GBP, EUR/JPY, GBP/JPY | 歐洲亞洲市場 |
| 🎯 **商品貨幣** | AUD/USD, NZD/USD, USD/CAD | 大宗商品相關 |
| 🔥 **新興市場** | USD/CNH, USD/SGD | 亞洲新興市場 |

### 2.4 服務時間

| 時間類型 | 說明 | 備註 |
|---------|------|------|
| 📊 **數據收集** | 24/7 持續運行 | 自動化 |
| 🤖 **AI 分析** | 每 15 分鐘 | 定時任務 |
| 🔔 **信號推送** | 即時 (條件觸發) | WebSocket |
| 👨‍💼 **技術支援** | 週一至週五 09:00-18:00 GMT+8 | 人工服務 |

---

## 3. 使用者需求分析

### 3.1 功能性需求

#### 3.1.1 交易者核心需求

| 需求類別 | 具體需求 | 優先級 | 實現狀態 |
|---------|---------|--------|---------|
| 🎯 **信號準確性** | 信號準確率 >70% | 🔴 高 | ✅ 已實現 |
| ⚡ **即時性** | 信號延遲 <1 秒 | 🔴 高 | ✅ 已實現 |
| 📊 **多時間框架** | 支援 7 種時間框架 | 🟡 中 | ✅ 已實現 |
| 💼 **多貨幣對** | 支援 12+ 貨幣對 | 🟡 中 | ✅ 已實現 |
| 🎨 **視覺化** | K 線圖、指標圖表 | 🟡 中 | ✅ 已實現 |
| 🔔 **多渠道通知** | Web + Discord + Email | 🔴 高 | ✅ 已實現 |
| 🛡️ **風險管理** | 止損/止盈建議 | 🔴 高 | ✅ 已實現 |
| 📈 **歷史績效** | 信號歷史與統計 | 🟢 低 | ✅ 已實現 |

#### 3.1.2 系統管理需求

| 需求類別 | 具體需求 | 實現方式 |
|---------|---------|---------|
| 🔐 **身份認證** | JWT Token 認證 | ✅ 已實現 |
| 👤 **使用者管理** | 註冊/登入/權限 | ✅ 已實現 |
| ⚙️ **個性化配置** | 風險偏好設定 | ✅ 已實現 |
| 📊 **數據持久化** | PostgreSQL 儲存 | ✅ 已實現 |
| 💾 **快取機制** | Redis 快取 | ⚠️ 需修復 |
| 🔄 **自動化任務** | 定時數據收集 | ✅ 已實現 |

### 3.2 非功能性需求

#### 3.2.1 效能需求

| 指標 | 目標值 | 當前狀態 | 說明 |
|------|-------|---------|------|
| ⚡ **API 響應時間** | <200ms (p95) | ✅ 達標 | 主要 API 端點 |
| 🗄️ **資料庫查詢** | <50ms (p95) | ✅ 達標 | 有索引優化 |
| 🔥 **ML 預測時間** | <1000ms | ✅ 達標 | 反轉預測 API |
| 📡 **WebSocket 延遲** | <100ms | ✅ 達標 | 即時推送 |
| 💾 **快取命中率** | >80% | ⚠️ 待測試 | Redis 快取 |
| ❌ **錯誤率** | <1% | ✅ 達標 | 系統穩定性 |

#### 3.2.2 安全性需求

```
安全性需求層級
├── 認證層 (Authentication)
│   ├── JWT Token 機制
│   ├── Refresh Token 自動更新
│   └── Token 過期管理
│
├── 授權層 (Authorization)
│   ├── 基於角色的訪問控制 (RBAC)
│   ├── API 端點權限檢查
│   └── 資源訪問限制
│
├── 資料保護 (Data Protection)
│   ├── 密碼 Bcrypt 加密 (10 rounds)
│   ├── 敏感資料加密儲存
│   └── HTTPS 傳輸加密
│
├── 防護機制 (Security Measures)
│   ├── Rate Limiting (100 req/15min)
│   ├── SQL Injection 防護
│   ├── XSS 攻擊防護
│   ├── CSRF Token 驗證
│   └── Helmet.js 安全標頭
│
└── 審計與監控 (Audit & Monitoring)
    ├── 操作日誌記錄
    ├── 異常行為偵測
    └── 安全事件告警
```

#### 3.2.3 可用性需求

| 需求項目 | 目標 | 實現方式 |
|---------|------|---------|
| 📊 **系統可用性** | 99.5% | 監控服務 + 自動重啟 |
| 🔄 **故障恢復** | <5 分鐘 | 健康檢查 + PM2 管理 |
| 💾 **資料備份** | 每日備份 | PostgreSQL 自動備份 |
| 📈 **擴展性** | 水平擴展 | 微服務架構設計 |
| 🔍 **可觀測性** | 完整日誌 | Winston + 日誌管理 |

#### 3.2.4 使用者體驗需求

| UX 需求 | 說明 | 實現狀態 |
|---------|------|---------|
| 🎨 **直觀介面** | 清晰的視覺設計 | ✅ Tailwind CSS |
| 📱 **響應式設計** | 支援多種設備 | ✅ 已實現 |
| ⚡ **快速載入** | 頁面載入 <2s | ✅ Vite 優化 |
| 🌐 **多語言支援** | 中/英文介面 | ⚠️ 規劃中 |
| ♿ **無障礙設計** | WCAG 2.1 標準 | ⚠️ 規劃中 |
| 🎓 **新手引導** | 使用教學 | ⚠️ 規劃中 |

### 3.3 業務需求

#### 3.3.1 盈利模式

```
盈利模式設計
├── 免費方案 (Free Tier)
│   ├── 基礎信號 (3 個貨幣對)
│   ├── 每日信號限制 (10 個)
│   └── 社群支援
│
├── 專業版 (Pro Tier) - $29/月
│   ├── 完整信號 (12+ 貨幣對)
│   ├── 無限制信號
│   ├── Discord 即時推送
│   ├── 進階技術分析
│   └── 優先客戶支援
│
├── 企業版 (Enterprise) - $299/月
│   ├── API 存取權限
│   ├── 自訂指標組合
│   ├── 白標服務
│   ├── 專屬客戶經理
│   └── SLA 保證
│
└── 附加服務
    ├── 歷史數據導出: $49/次
    ├── 自訂模型訓練: $199/次
    └── 一對一諮詢: $99/小時
```

#### 3.3.2 成長目標

| 時間階段 | 使用者目標 | 營收目標 | 關鍵指標 |
|---------|----------|---------|---------|
| **Q1 2025** | 1,000 註冊 | $5K MRR | MVP 上線 |
| **Q2 2025** | 5,000 註冊 | $25K MRR | 付費轉換 5% |
| **Q3 2025** | 15,000 註冊 | $75K MRR | 企業客戶 10+ |
| **Q4 2025** | 50,000 註冊 | $200K MRR | 市場領導地位 |

---

## 4. 系統功能架構圖

### 4.1 總體系統架構圖

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         AIFX v2 系統架構                                   │
└─────────────────────────────────────────────────────────────────────────┘

                    ┌──────────────────────────┐
                    │      使用者層              │
                    │  (User Interface Layer)   │
                    └──────────┬───────────────┘
                               │
              ┌────────────────┼────────────────┐
              │                │                │
         ┌────▼─────┐    ┌────▼─────┐    ┌────▼─────┐
         │  Web App │    │ Discord  │    │  Mobile  │
         │  (React) │    │   Bot    │    │   App    │
         │  Port    │    │ Commands │    │ (Future) │
         │  5173    │    │ /signal  │    │          │
         └────┬─────┘    └────┬─────┘    └────┬─────┘
              │                │                │
              └────────────────┼────────────────┘
                               │
                    ┌──────────▼───────────┐
                    │      API Gateway      │
                    │   (Load Balancer)    │
                    │      Nginx/Apache    │
                    └──────────┬───────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        │                      │                      │
   ┌────▼─────┐         ┌─────▼──────┐        ┌─────▼──────┐
   │ Backend  │         │   ML       │        │  Discord   │
   │  API     │◄───────►│  Engine    │        │   Bot      │
   │ Node.js  │         │  Python    │        │  Service   │
   │ Port     │         │  FastAPI   │        │  Node.js   │
   │ 3000     │         │  Port 8000 │        │            │
   └────┬─────┘         └─────┬──────┘        └─────┬──────┘
        │                     │                      │
        │              ┌──────▼──────┐               │
        │              │   Redis     │               │
        │              │   Cache     │               │
        │              │   Port 6379 │               │
        │              └──────┬──────┘               │
        │                     │                      │
   ┌────▼─────────────────────▼──────────────────────▼──────┐
   │                  PostgreSQL Database                   │
   │                      Port 5432                         │
   │  ┌────────────┬──────────────┬──────────────────────┐  │
   │  │   Users    │ TradingSignal│   MarketData         │  │
   │  │   Prefs    │   History    │   ModelVersion       │  │
   │  │  Position  │  Notification│   ABTest             │  │
   │  └────────────┴──────────────┴──────────────────────┘  │
   └────────────────────────────────────────────────────────┘
                               │
                    ┌──────────▼───────────┐
                    │   External APIs      │
                    │  ┌────────────────┐  │
                    │  │ Alpha Vantage  │  │
                    │  │ Twelve Data    │  │
                    │  │ Yahoo Finance  │  │
                    │  └────────────────┘  │
                    └──────────────────────┘
```

### 4.2 核心功能模組圖

```
┌─────────────────────────────────────────────────────────────────┐
│                      AIFX v2 功能模組                            │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────┐        ┌──────────────────┐
│  1. 認證授權模組  │        │  2. 市場數據模組  │
│  ┌─────────────┐ │        │  ┌─────────────┐ │
│  │ 使用者註冊   │ │        │  │ 即時價格     │ │
│  │ 登入/登出   │ │        │  │ 歷史數據     │ │
│  │ JWT Token  │ │        │  │ K線圖表     │ │
│  │ 權限管理    │ │        │  │ 技術指標     │ │
│  └─────────────┘ │        │  └─────────────┘ │
└──────────────────┘        └──────────────────┘
         │                           │
         └───────────┬───────────────┘
                     │
         ┌───────────▼────────────┐
         │   3. 交易信號生成模組   │
         │   ┌──────────────────┐ │
         │   │ 技術分析引擎      │ │
         │   │ ML 預測模型       │ │
         │   │ 信號評分系統      │ │
         │   │ 風險管理邏輯      │ │
         │   └──────────────────┘ │
         └───────────┬────────────┘
                     │
         ┌───────────┴────────────┐
         │                        │
┌────────▼──────────┐    ┌───────▼──────────┐
│ 4. 通知推送模組    │    │ 5. 個性化模組     │
│ ┌───────────────┐ │    │ ┌───────────────┐ │
│ │ WebSocket推送 │ │    │ │ 風險偏好設定   │ │
│ │ Discord Bot   │ │    │ │ 交易頻率選擇   │ │
│ │ Email 通知    │ │    │ │ 貨幣對偏好     │ │
│ │ 瀏覽器通知    │ │    │ │ 指標參數調整   │ │
│ └───────────────┘ │    │ └───────────────┘ │
└───────────────────┘    └──────────────────┘
         │                        │
         └───────────┬────────────┘
                     │
         ┌───────────▼────────────┐
         │   6. 倉位監控模組       │
         │   ┌──────────────────┐ │
         │   │ 開倉管理          │ │
         │   │ 止損止盈追蹤      │ │
         │   │ P&L 計算          │ │
         │   │ 風險預警          │ │
         │   └──────────────────┘ │
         └────────────────────────┘
```

### 4.3 數據流程圖

```
┌──────────────────────────────────────────────────────────────┐
│                    AIFX v2 數據流程                           │
└──────────────────────────────────────────────────────────────┘

   外部數據源                    系統處理                    使用者輸出

┌─────────────┐         ┌──────────────────┐         ┌─────────────┐
│ Alpha       │         │                  │         │             │
│ Vantage API │────────►│  1. 數據收集服務  │         │             │
└─────────────┘         │  marketData      │         │             │
                        │  Collector       │         │             │
┌─────────────┐         │  (每15分鐘運行)   │         │             │
│ Twelve Data │────────►│                  │         │             │
│ API         │         └────────┬─────────┘         │             │
└─────────────┘                  │                   │             │
                                 ▼                   │             │
┌─────────────┐         ┌────────────────┐          │             │
│ Yahoo       │────────►│  PostgreSQL    │          │             │
│ Finance API │         │  資料庫儲存     │          │             │
└─────────────┘         │  • MarketData  │          │             │
                        └────────┬───────┘          │             │
                                 │                   │             │
                                 ▼                   │             │
                        ┌────────────────┐          │   Web介面   │
                        │  2. 技術分析    │          │             │
                        │  Technical     │          │  ┌────────┐ │
                        │  Analysis      │─────────►│  │即時圖表│ │
                        │  • SMA         │          │  │K線顯示│ │
                        │  • RSI         │          │  │指標顯示│ │
                        │  • MACD        │          │  └────────┘ │
                        └────────┬───────┘          │             │
                                 │                   │  Discord    │
                                 ▼                   │             │
                        ┌────────────────┐          │  ┌────────┐ │
                        │  3. ML 預測     │          │  │信號推送│ │
                        │  ML Engine     │─────────►│  │即時通知│ │
                        │  • 反轉檢測     │          │  │指令互動│ │
                        │  • 價格預測     │          │  └────────┘ │
                        │  • 信心評分     │          │             │
                        └────────┬───────┘          │   Email     │
                                 │                   │             │
                                 ▼                   │  ┌────────┐ │
                        ┌────────────────┐          │  │日報摘要│ │
                        │  4. 信號生成    │─────────►│  │週報統計│ │
                        │  Signal        │          │  └────────┘ │
                        │  Generation    │          └─────────────┘
                        │  • 買賣建議     │
                        │  • 止損止盈     │
                        │  • 信心度       │
                        └────────┬───────┘
                                 │
                                 ▼
                        ┌────────────────┐
                        │  5. 通知推送    │
                        │  Notification  │
                        │  Service       │
                        │  • WebSocket   │
                        │  • Discord Bot │
                        │  • Email SMTP  │
                        └────────────────┘
```

### 4.4 使用者互動流程圖

```
┌──────────────────────────────────────────────────────────────┐
│                  使用者使用流程                               │
└──────────────────────────────────────────────────────────────┘

   使用者操作              系統響應              結果輸出

┌─────────────┐
│ 1. 註冊帳號  │
│   ↓         │         ┌────────────┐        ┌─────────────┐
│ 填寫資料     │────────►│ 驗證資料    │───────►│ 創建帳號     │
│ 設定密碼     │         │ Bcrypt加密  │        │ JWT Token   │
└─────────────┘         └────────────┘        └─────────────┘
                                                      │
┌─────────────┐                                      ▼
│ 2. 登入系統  │         ┌────────────┐        ┌─────────────┐
│   ↓         │────────►│ 驗證憑證    │───────►│ 進入儀表板   │
│ 輸入帳密     │         │ 發放Token   │        │ Dashboard   │
└─────────────┘         └────────────┘        └─────────────┘
                                                      │
┌─────────────┐                                      ▼
│ 3. 配置偏好  │         ┌────────────┐        ┌─────────────┐
│   ↓         │────────►│ 儲存設定    │───────►│ 個性化推薦   │
│ 風險等級     │         │ UserPrefs   │        │ 客製信號     │
│ 交易頻率     │         │ 資料庫      │        └─────────────┘
│ 偏好貨幣對   │         └────────────┘               │
└─────────────┘                                      ▼
                                                ┌─────────────┐
┌─────────────┐         ┌────────────┐        │ 即時接收信號 │
│ 4. 查看信號  │────────►│ 查詢最新    │───────►│ • 買/賣建議  │
│   ↓         │         │ 交易信號    │        │ • 信心評分   │
│ 選擇貨幣對   │         │ WebSocket   │        │ • 止損止盈   │
│ 設定時間框架 │         │ 推送        │        │ • 技術分析   │
└─────────────┘         └────────────┘        └─────────────┘
                                                      │
┌─────────────┐                                      ▼
│ 5. 執行交易  │         ┌────────────┐        ┌─────────────┐
│   ↓         │────────►│ 記錄倉位    │───────►│ 追蹤績效     │
│ 開倉操作     │         │ Position    │        │ P&L 計算    │
│ (外部券商)   │         │ Monitoring  │        │ 風險監控     │
└─────────────┘         └────────────┘        └─────────────┘
                                                      │
┌─────────────┐                                      ▼
│ 6. 績效分析  │         ┌────────────┐        ┌─────────────┐
│   ↓         │────────►│ 統計分析    │───────►│ 圖表報告     │
│ 查看歷史     │         │ Trading     │        │ • 勝率       │
│ 交易記錄     │         │ History     │        │ • 報酬率     │
└─────────────┘         └────────────┘        │ • 風險指標   │
                                               └─────────────┘
```

---

## 5. 核心功能說明

### 5.1 認證授權系統

#### 功能描述
提供安全的使用者認證與授權機制，保護使用者資料和系統資源。

#### 技術實現
```javascript
// JWT Token 架構
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",  // 15 分鐘有效期
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...", // 7 天有效期
  "user": {
    "id": 1,
    "email": "user@example.com",
    "role": "trader"
  }
}
```

#### API 端點
| 端點 | 方法 | 功能 | 權限 |
|------|------|------|------|
| `/api/v1/auth/register` | POST | 使用者註冊 | 公開 |
| `/api/v1/auth/login` | POST | 使用者登入 | 公開 |
| `/api/v1/auth/refresh` | POST | 刷新 Token | 需 Refresh Token |
| `/api/v1/auth/logout` | POST | 登出 | 需認證 |

#### 安全措施
- ✅ 密碼 Bcrypt 加密 (10 rounds)
- ✅ JWT Token 機制
- ✅ Refresh Token 自動續期
- ✅ Rate Limiting (100 req/15min)
- ✅ CORS 跨域保護

---

### 5.2 市場數據服務

#### 功能描述
提供即時和歷史外匯市場數據，支援多種時間框架和技術指標計算。

#### 數據來源
```
數據供應商層級 (優先順序)
├── 主要: Alpha Vantage API
│   └── 限制: 5 請求/分鐘, 500 請求/日
├── 備用: Twelve Data API
│   └── 限制: 800 請求/日
└── 輔助: Yahoo Finance (yfinance)
    └── 限制: 無官方限制，社群維護
```

#### 技術指標支援

| 指標 | 說明 | 用途 | 參數 |
|------|------|------|------|
| **SMA** | 簡單移動平均 | 趨勢判斷 | 週期: 5, 10, 20, 50, 200 |
| **RSI** | 相對強弱指標 | 超買超賣 | 週期: 14, 範圍: 0-100 |
| **MACD** | 移動平均收斂發散 | 趨勢轉折 | 快線: 12, 慢線: 26, 信號: 9 |
| **Bollinger Bands** | 布林通道 | 波動度 | 週期: 20, 標準差: 2 |

#### API 端點
| 端點 | 方法 | 功能 |
|------|------|------|
| `/api/v1/market/price/:pair` | GET | 即時價格 |
| `/api/v1/market/history/:pair` | GET | 歷史數據 |
| `/api/v1/market/indicators/:pair` | GET | 技術指標 |
| `/api/v1/market/overview` | GET | 市場總覽 |

#### 快取策略
```javascript
// Redis 快取配置
{
  "real-time": {
    "TTL": 60,        // 60 秒
    "key": "forex:price:{pair}"
  },
  "historical": {
    "TTL": 86400,     // 1 天
    "key": "forex:history:{pair}:{timeframe}"
  },
  "indicators": {
    "TTL": 300,       // 5 分鐘
    "key": "forex:indicators:{pair}:{indicator}"
  }
}
```

---

### 5.3 AI 交易信號生成

#### 功能描述
結合技術分析、機器學習和風險管理，生成高準確度的交易信號。

#### 信號生成流程
```
信號生成管道 (Pipeline)

1. 數據準備
   ├── 獲取最新價格數據
   ├── 計算技術指標
   └── 正規化數據

2. 多因子分析
   ├── 技術分析因子 (40%)
   │   ├── 趨勢判斷 (SMA)
   │   ├── 動量分析 (RSI)
   │   └── 波動度 (BB)
   ├── ML 預測因子 (40%)
   │   ├── 反轉檢測模型
   │   ├── 價格預測模型
   │   └── 模式識別
   └── 情緒分析因子 (20%)
       └── 市場情緒指標

3. 信號綜合評分
   ├── 加權平均計算
   ├── 信心度評估 (0.0-1.0)
   └── 過濾低信心信號 (<0.6)

4. 風險管理
   ├── 止損點位計算
   ├── 止盈點位計算
   ├── 風險報酬比評估
   └── 倉位建議

5. 信號輸出
   ├── 買入/賣出/持有建議
   ├── 進場價格
   ├── 止損價格
   ├── 止盈價格
   └── 信心評分
```

#### 信號格式
```json
{
  "signal_id": "SIG_20251120_001",
  "pair": "EUR/USD",
  "timeframe": "1h",
  "timestamp": "2025-11-20T10:30:00Z",
  "action": "BUY",
  "confidence": 0.78,
  "entry_price": 1.0850,
  "stop_loss": 1.0820,
  "take_profit_1": 1.0890,
  "take_profit_2": 1.0920,
  "risk_reward_ratio": 2.5,
  "factors": {
    "technical": 0.75,
    "ml_prediction": 0.82,
    "sentiment": 0.68
  },
  "reasoning": [
    "RSI 顯示超賣，可能反彈",
    "MACD 金叉形成，趨勢轉多",
    "ML 模型預測上漲機率 82%"
  ]
}
```

#### API 端點
| 端點 | 方法 | 功能 |
|------|------|------|
| `/api/v1/trading/signals` | POST | 生成交易信號 |
| `/api/v1/trading/signals/history` | GET | 歷史信號查詢 |
| `/api/v1/trading/signals/:id` | GET | 單一信號詳情 |

---

### 5.4 機器學習引擎

#### 功能描述
基於 Python + FastAPI 的 ML 服務，提供價格預測和反轉檢測功能。

#### 模型架構
```
ML Engine 模型層級

├── 反轉檢測模型 (Reversal Detection)
│   ├── 模型類型: 組合模型
│   ├── 輸入: 60 根 K 線
│   ├── 輸出: 反轉機率 (0-1)
│   └── 準確率: ~75%
│
├── 價格預測模型 (Price Prediction)
│   ├── 模型類型: LSTM (規劃中)
│   ├── 輸入: 歷史價格序列
│   ├── 輸出: 未來 N 期價格
│   └── 狀態: 開發中
│
└── 模式識別模型 (Pattern Recognition)
    ├── 模型類型: CNN (規劃中)
    ├── 輸入: K 線圖影像
    ├── 輸出: 圖表型態分類
    └── 狀態: 規劃中
```

#### ML API 端點
| 端點 | 方法 | 功能 |
|------|------|------|
| `/health` | GET | 健康檢查 |
| `/market-data/:pair` | GET | 市場數據獲取 |
| `/reversal/predict_raw` | POST | 反轉預測 |
| `/reversal/analyze/:pair` | GET | 反轉分析 |

#### 模型訓練流程
```
模型訓練管道

1. 數據收集
   └── 從資料庫獲取歷史信號和結果

2. 特徵工程
   ├── 技術指標特徵
   ├── 價格變化特徵
   └── 時間特徵

3. 模型訓練
   ├── 訓練集/驗證集分割 (80/20)
   ├── 超參數調優
   └── 交叉驗證

4. 模型評估
   ├── 準確率 (Accuracy)
   ├── 精確率 (Precision)
   ├── 召回率 (Recall)
   └── F1 分數

5. 模型部署
   ├── 版本控制
   ├── A/B 測試
   └── 性能監控
```

---

### 5.5 Discord Bot 整合

#### 功能描述
透過 Discord Bot 提供即時交易信號推送和互動式指令功能。

#### Bot 指令列表

| 指令 | 功能 | 範例 |
|------|------|------|
| `/signal` | 獲取最新信號 | `/signal EURUSD 1h` |
| `/subscribe` | 訂閱信號推送 | `/subscribe EURUSD` |
| `/unsubscribe` | 取消訂閱 | `/unsubscribe EURUSD` |
| `/preferences` | 設定偏好 | `/preferences risk 7` |
| `/position` | 查看倉位 | `/position list` |
| `/help` | 顯示幫助 | `/help` |

#### 通知機制
```
Discord 通知層級

├── 即時信號 (Real-time Signals)
│   ├── 觸發條件: 新信號生成
│   ├── 推送頻率: 即時
│   └── 去重邏輯: 4 小時內同一信號不重複

├── 市場預警 (Market Alerts)
│   ├── 觸發條件: 重大市場變動
│   ├── 推送頻率: 按需
│   └── 優先級: 高

├── 倉位提醒 (Position Alerts)
│   ├── 觸發條件: 止損/止盈觸發
│   ├── 推送頻率: 即時
│   └── 優先級: 緊急

└── 每日摘要 (Daily Summary)
    ├── 觸發條件: 定時任務
    ├── 推送頻率: 每日 18:00 GMT+8
    └── 內容: 當日信號統計、績效總結
```

#### 訊息格式
```markdown
🎯 **EUR/USD 交易信號**

📊 **信號詳情**
• 方向: 🟢 買入 (BUY)
• 信心度: ⭐⭐⭐⭐ 78%
• 時間框架: 1 小時

💰 **價格資訊**
• 進場價格: 1.0850
• 止損價格: 1.0820 (-30 pips)
• 止盈價格: 1.0890 (+40 pips)
• 風險報酬比: 1:1.33

📈 **技術分析**
• RSI(14): 35 (超賣區域)
• MACD: 金叉形成
• SMA(20): 價格突破均線

🤖 **AI 預測**
• 反轉機率: 82%
• 上漲預期: 中期看多

⚠️ **風險提示**
建議倉位: 賬戶的 2-3%
嚴格遵守止損點位

⏰ 信號時間: 2025-11-20 10:30:00 GMT+8
```

---

### 5.6 倉位監控系統

#### 功能描述
追蹤使用者開倉位置，監控止損止盈，計算盈虧。

#### 監控流程
```
倉位監控流程

1. 開倉記錄
   ├── 使用者手動記錄開倉
   ├── 記錄進場價格
   ├── 設定止損止盈
   └── 儲存到資料庫

2. 即時監控 (每 60 秒)
   ├── 獲取最新市場價格
   ├── 計算當前盈虧
   ├── 檢查止損/止盈觸發
   └── 更新倉位狀態

3. 風險預警
   ├── 接近止損 (5 pips 內)
   │   └── 發送預警通知
   ├── 達到止損
   │   └── 發送止損通知
   └── 達到止盈
       └── 發送止盈通知

4. 平倉處理
   ├── 使用者手動平倉
   ├── 記錄平倉價格
   ├── 計算最終盈虧
   ├── 更新交易歷史
   └── 績效統計更新
```

#### 倉位資訊
```json
{
  "position_id": "POS_20251120_001",
  "user_id": 1,
  "pair": "EUR/USD",
  "direction": "LONG",
  "entry_price": 1.0850,
  "current_price": 1.0875,
  "stop_loss": 1.0820,
  "take_profit": 1.0920,
  "lot_size": 0.1,
  "unrealized_pnl": 25.00,
  "unrealized_pnl_pips": 25,
  "status": "OPEN",
  "open_time": "2025-11-20T10:30:00Z",
  "risk_percentage": 2.5
}
```

---

## 6. 技術規格

### 6.1 系統環境需求

#### 6.1.1 伺服器需求

| 組件 | 最低配置 | 推薦配置 |
|------|---------|---------|
| **CPU** | 2 核心 | 4 核心+ |
| **記憶體** | 4 GB | 8 GB+ |
| **硬碟** | 20 GB SSD | 50 GB SSD+ |
| **網路** | 100 Mbps | 1 Gbps |
| **作業系統** | Ubuntu 20.04+ | Ubuntu 22.04 LTS |

#### 6.1.2 軟體依賴

```
系統依賴清單

├── Node.js 環境
│   ├── Node.js: v18.0.0+
│   ├── npm: v9.0.0+
│   └── PM2: v5.3.0+ (程序管理)
│
├── Python 環境
│   ├── Python: v3.9.0+
│   ├── pip: v21.0.0+
│   └── virtualenv (建議)
│
├── 資料庫
│   ├── PostgreSQL: v14.0+
│   ├── Redis: v6.0.0+
│   └── pgAdmin 4 (管理工具)
│
└── Web 伺服器
    ├── Nginx: v1.20.0+ (推薦)
    └── Apache: v2.4.0+ (替代)
```

### 6.2 效能指標

#### 6.2.1 響應時間目標

| 端點類型 | 目標響應時間 | P95 | P99 |
|---------|------------|-----|-----|
| 認證端點 | <100ms | <150ms | <300ms |
| 市場數據 | <200ms | <300ms | <500ms |
| 信號生成 | <500ms | <800ms | <1500ms |
| ML 預測 | <1000ms | <1500ms | <3000ms |
| WebSocket | <100ms | <150ms | <300ms |

#### 6.2.2 吞吐量目標

| 指標 | 目標值 | 說明 |
|------|-------|------|
| API QPS | 100+ | 每秒查詢數 |
| 並發使用者 | 1000+ | 同時線上使用者 |
| WebSocket 連接 | 5000+ | 並發 WebSocket |
| 資料庫 TPS | 1000+ | 每秒事務數 |

### 6.3 擴展性設計

#### 6.3.1 水平擴展方案

```
擴展架構

                    ┌─────────────┐
                    │ Load        │
                    │ Balancer    │
                    │ (Nginx)     │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
   ┌────▼────┐       ┌─────▼────┐       ┌────▼────┐
   │ Backend │       │ Backend  │       │ Backend │
   │ Node 1  │       │ Node 2   │       │ Node N  │
   └────┬────┘       └─────┬────┘       └────┬────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
                    ┌──────▼──────┐
                    │ PostgreSQL  │
                    │ Master/Slave│
                    └─────────────┘
                           │
                    ┌──────▼──────┐
                    │ Redis       │
                    │ Cluster     │
                    └─────────────┘
```

#### 6.3.2 資料庫優化

| 優化項目 | 實現方式 |
|---------|---------|
| **索引優化** | 為常查詢欄位建立索引 |
| **分區表** | 按時間分區歷史數據 |
| **連接池** | Sequelize 連接池 (min: 5, max: 30) |
| **查詢優化** | 使用 EXPLAIN 分析查詢 |
| **讀寫分離** | Master-Slave 架構 |
| **快取層** | Redis 快取熱點數據 |

### 6.4 監控與日誌

#### 6.4.1 監控指標

```
監控體系

├── 應用層監控
│   ├── API 響應時間
│   ├── 錯誤率
│   ├── QPS/TPS
│   └── 服務可用性
│
├── 系統層監控
│   ├── CPU 使用率
│   ├── 記憶體使用率
│   ├── 硬碟 I/O
│   └── 網路流量
│
├── 資料庫監控
│   ├── 連接數
│   ├── 查詢時間
│   ├── 慢查詢
│   └── 鎖等待
│
└── 業務層監控
    ├── 使用者活躍度
    ├── 信號生成數量
    ├── 信號準確率
    └── 使用者轉換率
```

#### 6.4.2 日誌管理

| 日誌類型 | 級別 | 儲存位置 | 保留期限 |
|---------|------|---------|---------|
| **訪問日誌** | INFO | `/var/log/nginx/` | 30 天 |
| **應用日誌** | INFO/ERROR | `/var/log/aifx/` | 90 天 |
| **錯誤日誌** | ERROR | `/var/log/aifx/error.log` | 180 天 |
| **審計日誌** | INFO | PostgreSQL | 1 年 |
| **性能日誌** | DEBUG | `/var/log/aifx/perf.log` | 7 天 |

---

## 📊 附錄

### A. 相關文檔

- [API 文檔](backend/docs/API.md)
- [資料庫架構](docs/setup/DATABASE_ARCHITECTURE.md)
- [部署指南](docs/setup/COMPLETE_SETUP_GUIDE.md)
- [測試指南](docs/testing/TESTING_ALL_PHASES.md)
- [開發規範](CLAUDE.md)

### B. 聯絡資訊

- **GitHub**: https://github.com/LazOof69/AIFX_v2

---

**文檔結束**

*本文檔由 AIFX v2 開發團隊維護，最後更新於 2025-11-20*
